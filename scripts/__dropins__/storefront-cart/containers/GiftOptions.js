/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as d,Fragment as I,jsx as e}from"@dropins/tools/preact-jsx-runtime.js";import{classes as he}from"@dropins/tools/lib.js";import{Modal as _e,Price as de,ContentGrid as xe,ImageSwatch as Ne,Button as oe,Skeleton as Pe,SkeletonRow as Me,Field as X,Checkbox as ne,Input as me,TextArea as We,Accordion as Ce,AccordionSection as Ge,Icon as U,Card as ye,ProgressSpinner as be}from"@dropins/tools/components.js";/* empty css                   */import*as Y from"@dropins/tools/preact-compat.js";import{useState as V,useEffect as le,useCallback as Z,useMemo as Oe}from"@dropins/tools/preact-hooks.js";import{useText as J}from"@dropins/tools/i18n.js";import{s as E}from"../chunks/state.js";import{S as Te}from"../chunks/ChevronUp.js";import{S as Fe}from"../chunks/ChevronDown.js";import{events as Re}from"@dropins/tools/event-bus.js";import{u as Ve}from"../chunks/updateProductsFromCart.js";import{s as $e}from"../chunks/setGiftOptionsOnCart.js";import"../chunks/refreshCart.js";import"../chunks/resetCart.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/acdl.js";const ie=r=>Y.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},Y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),Y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),se=r=>Y.createElement("svg",{width:20,height:23,viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},Y.createElement("path",{d:"M10 6L10 21.5M10 6H12.25C13.4926 6 14.5 4.99264 14.5 3.75C14.5 2.50736 13.4926 1.5 12.25 1.5C11.0074 1.5 10 2.50736 10 3.75M10 6V3.75M10 6H7.75C6.50736 6 5.5 4.99264 5.5 3.75C5.5 2.50736 6.50736 1.5 7.75 1.5C8.99264 1.5 10 2.50736 10 3.75M3.25 10.75H16.75C17.9926 10.75 19 9.74264 19 8.5C19 7.25736 17.9926 6.25 16.75 6.25H3.25C2.00736 6.25 1 7.25736 1 8.5C1 9.74264 2.00736 10.75 3.25 10.75ZM4.75 21.5H15.25C16.4926 21.5 17.5 20.4926 17.5 19.25V13.25C17.5 12.0074 16.4926 11 15.25 11H4.75C3.50736 11 2.5 12.0074 2.5 13.25V19.25C2.5 20.4926 3.50736 21.5 4.75 21.5Z",stroke:"currentColor",strokeWidth:1.5})),Se=({view:r,showModal:i,productName:c,giftWrappingConfig:a,setShowModal:t,updateGiftOptions:f})=>{var G;const p=J({modalTitle:"Cart.GiftOptions.modal.title",defaultTitle:"Cart.GiftOptions.modal.defaultTitle",modalWrappingText:"Cart.GiftOptions.modal.wrappingText",modalWrappingSubText:"Cart.GiftOptions.modal.wrappingSubText",modalConfirmButton:"Cart.GiftOptions.modal.modalConfirmButton",modalCancelButton:"Cart.GiftOptions.modal.modalCancelButton"}),[n,h]=V();if(le(()=>{h(a.find(o=>o.selected)??a[0])},[a]),!i||!a.length)return null;const F=c?`${p.modalTitle} ${c}`:p.defaultTitle;return d(_e,{"data-testid":`gift-option-modal-${r}`,className:"cart-gift-options-view__modal",size:"medium",title:d(I,{children:[e("span",{children:F}),n&&((G=n==null?void 0:n.price)==null?void 0:G.value)>0?e(de,{amount:n.price.value,currency:n.price.currency,weight:"normal"}):null]}),centered:!0,onClose:()=>t(!1),children:[d("div",{className:"cart-gift-options-view__modal-content",children:[e("span",{className:"cart-gift-options-view__modal-text",children:p.modalWrappingText}),e(xe,{emptyGridContent:e(I,{}),maxColumns:6,columnWidth:"100px",className:"cart-gift-options-view__modal-grid",children:a.map(o=>e(Ne,{selected:(n==null?void 0:n.uid)===(o==null?void 0:o.uid),onValue:()=>{h(o)},name:"giftWrappingId",value:o.uid,src:o.image.url,alt:o.image.design,label:o.image.design,className:"cart-gift-options-view__modal-grid-item"},o.uid))}),e("span",{className:"cart-gift-options-view__modal-sub-text",children:n==null?void 0:n.design})]}),e(oe,{type:"button",onClick:()=>{f("giftWrappingId",n==null?void 0:n.uid,{giftOptionsWrap:!0}),t(!1)},children:p.modalConfirmButton}),e(oe,{type:"button",variant:"secondary",onClick:()=>t(!1),children:p.modalCancelButton})]})},ke=()=>e(Pe,{children:e(Me,{variant:"row",size:"small",fullWidth:!0,lines:1,multilineGap:"small"})}),Ae=({className:r,view:i,item:c,giftOptions:a,disabled:t,onInputChange:f,cartData:p,giftWrappingConfig:n,setShowModal:h,isProductView:F,isGiftReceiptVisible:G,isPrintedCartVisible:o,isGiftWrappingVisible:v})=>{var B,A,b,g;const u=J({customize:`Cart.GiftOptions.${i}.customize`,giftReceiptIncludedTitle:`Cart.GiftOptions.${i}.giftReceiptIncluded.title`,giftReceiptIncludedText:`Cart.GiftOptions.${i}.giftReceiptIncluded.subtitle`,printedCardIncludedTitle:`Cart.GiftOptions.${i}.printedCardIncluded.title`,printedCardIncludedText:`Cart.GiftOptions.${i}.printedCardIncluded.subtitle`,giftOptionsWrapTitle:`Cart.GiftOptions.${i}.giftOptionsWrap.title`,giftOptionsWrapText:`Cart.GiftOptions.${i}.giftOptionsWrap.subtitle`,requiredFieldError:"Cart.GiftOptions.formText.requiredFieldError"}),_=(c==null?void 0:c.productGiftWrapping)??[],x=(p==null?void 0:p.cartGiftWrapping)??[],s=(F?_:x).find(P=>P.uid===a.giftWrappingId),w=(s==null?void 0:s.design)??"",C=c==null?void 0:c.giftWrappingPrice,z=w?`${u.giftOptionsWrapText} ${w}`:"",L=+(((A=(B=E.config)==null?void 0:B.printedCardPrice)==null?void 0:A.value)??0)>0?(b=E.config)==null?void 0:b.printedCardPrice:null;let k=null;C!=null&&C.value?k=C:(g=s==null?void 0:s.price)!=null&&g.value&&(k=s.price);const m=P=>P?d("span",{children:["Â (+",e(de,{amount:P.value,currency:P.currency,weight:"normal"}),")"]}):null;return!G&&!o&&!v?null:d("div",{className:he([r]),children:[G?e(X,{disabled:t,className:"cart-gift-options-view__field-gift-receipt",children:e(ne,{disabled:t,name:"giftReceiptIncluded",checked:a.giftReceiptIncluded,placeholder:u.giftReceiptIncludedTitle,label:u.giftReceiptIncludedTitle,description:u.giftReceiptIncludedText,onChange:f})}):null,o?e(X,{disabled:t,className:"cart-gift-options-view__field-printed-card",children:e(ne,{disabled:t,name:"printedCardIncluded",checked:a.printedCardIncluded,placeholder:u.printedCardIncludedTitle,label:d(I,{children:[u.printedCardIncludedTitle,m(L)]}),description:u.printedCardIncludedText,onChange:f})}):null,v?d(I,{children:[e(X,{disabled:t,className:"cart-gift-options-view__field-gift-wrap",children:e(ne,{disabled:t,name:"isGiftWrappingSelected",checked:a.isGiftWrappingSelected,placeholder:u.giftOptionsWrapTitle,label:d(I,{children:[u.giftOptionsWrapTitle,m(k)]}),description:z,onChange:f})}),e(oe,{disabled:t||!n.length,type:"button","data-testid":`gift-option-customize-${i}`,variant:"tertiary",onClick:()=>h(!0),children:u.customize})]}):null]})},Ie=({view:r,giftOptions:i,disabled:c,errorMessage:a,onInputChange:t,onBlur:f,giftMessageAvailable:p})=>{const n=J({formTitle:`Cart.GiftOptions.${r}.formContent.formTitle`,formTo:`Cart.GiftOptions.${r}.formContent.formTo`,formFrom:`Cart.GiftOptions.${r}.formContent.formFrom`,giftMessageTitle:`Cart.GiftOptions.${r}.formContent.giftMessageTitle`,formToPlaceholder:`Cart.GiftOptions.${r}.formContent.formToPlaceholder`,formFromPlaceholder:`Cart.GiftOptions.${r}.formContent.formFromPlaceholder`,formMessagePlaceholder:`Cart.GiftOptions.${r}.formContent.formMessagePlaceholder`});return p?d(I,{children:[e("span",{children:n.formTitle}),d("div",{children:[e("span",{children:n.formTo}),e(X,{disabled:c,error:a.recipientName,children:e(me,{disabled:c,type:"text",name:"recipientName",value:i.recipientName,placeholder:n.formToPlaceholder,onChange:t,onBlur:f})})]}),d("div",{children:[e("span",{children:n.formFrom}),e(X,{disabled:c,error:a.senderName,children:e(me,{disabled:c,type:"text",name:"senderName",value:i.senderName,placeholder:n.formFromPlaceholder,onChange:t,onBlur:f})})]}),d("div",{children:[e("span",{children:n.giftMessageTitle}),e(X,{disabled:c,children:e(We,{errorMessage:a.message,disabled:c,name:"message",value:i.message,label:n.formMessagePlaceholder,onChange:t,onBlur:f})})]})]}):null},Ee=({view:r,giftOptions:i,giftWrappingConfig:c,readOnlyFormOrderView:a})=>{const t=J({readOnlyProductTitle:"Cart.GiftOptions.product.readOnlyFormView.title",wrapping:"Cart.GiftOptions.product.readOnlyFormView.wrapping",recipient:"Cart.GiftOptions.product.readOnlyFormView.recipient",sender:"Cart.GiftOptions.product.readOnlyFormView.sender",message:"Cart.GiftOptions.product.readOnlyFormView.message",readOnlyOrderTitle:"Cart.GiftOptions.order.readOnlyFormView.title",readOnlyOrderGiftReceiptTitle:"Cart.GiftOptions.order.readOnlyFormView.giftReceipt",readOnlyOrderGiftReceiptText:"Cart.GiftOptions.order.readOnlyFormView.giftReceiptText",readOnlyOrderGiftPrintCardTitle:"Cart.GiftOptions.order.readOnlyFormView.printCard",readOnlyOrderGiftPrintCardText:"Cart.GiftOptions.order.readOnlyFormView.printCardText",readOnlyOrderGiftWrapTitle:"Cart.GiftOptions.order.readOnlyFormView.giftWrap",readOnlyOrderGiftWrapOptionsText:"Cart.GiftOptions.order.readOnlyFormView.giftWrapOptions",readOnlyOrderFormTitle:"Cart.GiftOptions.order.readOnlyFormView.formTitle",readOnlyOrderFormTo:"Cart.GiftOptions.order.readOnlyFormView.formTo",readOnlyOrderFormFrom:"Cart.GiftOptions.order.readOnlyFormView.formFrom",readOnlyOrderFormMessageTitle:"Cart.GiftOptions.order.readOnlyFormView.formMessageTitle"}),{recipientName:f,senderName:p,message:n,giftReceiptIncluded:h,printedCardIncluded:F,isGiftWrappingSelected:G}=i,o=c.find(({uid:s})=>s===(i==null?void 0:i.giftWrappingId)),v=!!f||!!p||!!n,u=o==null?void 0:o.design,_=h||F||(o==null?void 0:o.selected),x=[{id:1,title:t.wrapping,message:G?u:""},{id:2,title:t.recipient,message:f},{id:3,title:t.sender,message:p},{id:4,title:t.message,message:n}],N=x.every(({message:s})=>!s);if(r==="product"&&!N)return e(Ce,{"data-testid":"gift-options-product",iconClose:Te,iconOpen:Fe,actionIconPosition:"right",children:e(Ge,{title:t.readOnlyProductTitle,showIconLeft:!0,iconLeft:se,defaultOpen:!1,renderContentWhenClosed:!1,children:e("div",{children:x.filter(s=>s.message).map(s=>d("p",{children:[s.title," ",s.message]},s.id))})})});if(r==="order"&&(v||_)){const s=d("div",{className:"cart-gift-options-readonly__header",children:[e(U,{source:se,size:"24"}),e("span",{children:t.readOnlyOrderTitle})]}),w=d(I,{children:[h?d("div",{className:"cart-gift-options-readonly__checkboxes",children:[e(U,{source:ie,size:"16"}),e("p",{children:t.readOnlyOrderGiftReceiptTitle}),e("p",{children:t.readOnlyOrderGiftReceiptText})]}):null,F?d("div",{className:"cart-gift-options-readonly__checkboxes",children:[e(U,{source:ie,size:"16"}),e("p",{children:t.readOnlyOrderGiftPrintCardTitle}),e("p",{children:t.readOnlyOrderGiftPrintCardText})]}):null,o!=null&&o.selected?d("div",{className:"cart-gift-options-readonly__checkboxes",children:[e(U,{source:ie,size:"16"}),d("p",{children:[t.readOnlyOrderGiftWrapTitle," (+",e(de,{amount:o.price.value,currency:o.price.currency,weight:"normal"}),")"]}),e("p",{children:`${t.readOnlyOrderGiftWrapOptionsText} ${o==null?void 0:o.design}`})]}):null]}),C=v?d("div",{className:"cart-gift-options-readonly__form",children:[e("div",{children:t.readOnlyOrderFormTitle}),d("div",{children:[d("p",{children:[e("span",{children:t.readOnlyOrderFormTo}),e("span",{children:f})]}),d("p",{children:[e("span",{children:t.readOnlyOrderFormFrom}),e("span",{children:p})]})]}),d("div",{children:[e("p",{children:t.readOnlyOrderFormMessageTitle}),e("p",{children:n})]})]}):null;return d(ye,{variant:a,children:[s,w,C]})}return null},te={recipientName:"",senderName:"",message:""},Be={giftReceiptIncluded:!1,printedCardIncluded:!1,isGiftWrappingSelected:!1},we=(r,i)=>{var a,t;if(!i)return(a=E.config)==null?void 0:a.allowGiftMessageOnOrder;const c=((t=E.config)==null?void 0:t.allowGiftMessageOnOrderItems)??"";return typeof(r==null?void 0:r.giftMessageAvailable)=="boolean"?r==null?void 0:r.giftMessageAvailable:!!c},He=({item:r,view:i,loading:c,giftOptions:a,showModal:t,isEditable:f,errorsField:p,updateLoading:n,cartData:h,fieldsDisabled:F,isGiftOptionsApplied:G,giftWrappingConfig:o,readOnlyFormOrderView:v,onBlur:u,setShowModal:_,updateGiftOptions:x,onInputChange:N,handleFormMouseLeave:s})=>{var R,j,D,ee;const w=J({accordionHeading:`Cart.GiftOptions.${i}.accordionHeading`}),C=i==="product",z=(R=h==null?void 0:h.items)==null?void 0:R.every(Q=>Q.giftWrappingAvailable),L=(j=E.config)==null?void 0:j.allowGiftWrappingOnOrder,k=(D=E.config)==null?void 0:D.allowGiftReceipt,m=(ee=E.config)==null?void 0:ee.allowPrintedCard,B=r==null?void 0:r.giftWrappingAvailable,A=C?!1:!!k,b=C?!1:!!m,g=C?!!B&&o.length>0:!!L&&o.length>0&&!!z,P=A&&b&&g,q=we(r,C),H=Z(Q=>e(Ce,{"data-testid":"gift-options-product",iconClose:Te,iconOpen:Fe,actionIconPosition:"right",children:e(Ge,{title:d("div",{className:"cart-gift-options-view__icon--success",children:[e("span",{children:w.accordionHeading}),G?e(U,{source:ie,size:"16"}):null]}),showIconLeft:!0,iconLeft:se,defaultOpen:G||Q,renderContentWhenClosed:!0,children:d(I,{children:[e(Ae,{className:"cart-gift-options-view__top",view:i,item:r,giftOptions:a,disabled:F,onInputChange:N,cartData:h,giftWrappingConfig:o,setShowModal:_,isProductView:C,isGiftReceiptVisible:A,isPrintedCartVisible:b,isGiftWrappingVisible:g}),e("form",{className:"cart-gift-options-view__footer",onMouseLeave:s,children:e(Ie,{view:i,giftOptions:a,disabled:F,errorMessage:p,onInputChange:N,onBlur:u,giftMessageAvailable:q})})]})})}),[w.accordionHeading,G,i,r,a,F,N,h,o,_,s,p,u]);return C&&!P&&!q?null:d("div",{id:"cart-gift-options-view",className:he(["cart-gift-options-view",`cart-gift-options-view--${i}`,["cart-gift-options-view--loading",n]]),children:[n?e(be,{className:"cart-gift-options-view__spinner"}):null,c?e(ke,{}):d(I,{children:[f?null:e("div",{className:"cart-gift-options-view--readonly",children:e(Ee,{view:i,giftOptions:a,giftWrappingConfig:o,readOnlyFormOrderView:v})}),e(Se,{view:i,productName:(r==null?void 0:r.name)??"",showModal:t,giftWrappingConfig:o,setShowModal:_,updateGiftOptions:x}),i==="product"&&f?H(!1):null,i==="order"&&f?e(ye,{variant:"secondary",children:H(!0)}):null]})]})},ze=({item:r,view:i,dataSource:c,initialLoading:a,handleItemsLoading:t,handleItemsError:f,onItemUpdate:p})=>{var ae,ce,pe,fe,ue,ge;const n=i==="product",h=J({requiredFieldError:"Cart.GiftOptions.formText.requiredFieldError"}),[F,G]=V(a),[o,v]=V(!1),[u,_]=V(!1),[x,N]=V(!1),[s,w]=V(!1),[C,z]=V(!1),[L,k]=V([]),[m,B]=V(null),[A,b]=V(te),[g,P]=V(()=>({giftWrappingId:"",...te,...Be})),q=((ae=g.recipientName)==null?void 0:ae.trim())&&((ce=g.senderName)==null?void 0:ce.trim())&&((pe=g.message)==null?void 0:pe.trim()),H=!((fe=g.recipientName)!=null&&fe.trim())&&!((ue=g.senderName)!=null&&ue.trim())&&!((ge=g.message)!=null&&ge.trim()),R=Z(async l=>{switch(v(i==="order"),_(!0),i){case"product":{t==null||t(r.uid,!0),f==null||f(r.uid);const{recipientName:O,senderName:y,message:T,giftWrappingId:$,isGiftWrappingSelected:M}=l,re={gift_message:{to:O||"",from:y||"",message:T||""},gift_wrapping_id:M?$:null};await Ve([{uid:r.uid,quantity:r.quantity,giftOptions:re}]).then(()=>{p==null||p({item:r})}).finally(()=>{t==null||t(r.uid,!1),_(!1),N(!1),v(!1)}).catch(S=>{console.warn(S)})}break;case"order":await $e(l).finally(()=>{_(!1),N(!1),v(!1)});break;default:console.error('Incorrect "view" prop value provided for GiftOptions container (storefront-cart)');break}},[f,t,r,p,i]),j=Z((l,O,y={})=>{P(T=>{const $=W=>W in T,M=W=>$(W)?T[W]:void 0;if(!(M(l)!==O||Object.keys(y).some(W=>M(W)!==y[W])))return T;const S={...T,[l]:O,...y};return!S.recipientName&&!S.senderName&&!S.message&&w(!0),(typeof O=="boolean"||["giftWrappingId","giftReceiptIncluded","printedCardIncluded"].includes(l))&&R(S),N(!0),S})},[R]),D=Z(async()=>{u||(H&&s&&(b(te),w(!1),await R(g)),x&&q&&(w(!0),await R(g)))},[R,g,x,H,s,u]),ee=Z(async l=>{if(console.log("BLURR!",u),u)return;const{name:O,value:y}=l.target;b(T=>({...T,[O]:y.trim()?"":h.requiredFieldError})),H&&s&&(b(te),w(!1),await R(g)),x&&q&&await R(g)},[R,h,g,x,H,s,u]),Q=Z(l=>{const O=l.target.name,y=l.target,T=y.type==="checkbox"?y.checked:y.value;j(O,T)},[j]);le(()=>{if(n)return;const l=Re.on(c==="cart"?"cart/data":"order/data",O=>{B(O)},{eager:!0});return()=>{l==null||l.off()}},[c,n]);const K=Oe(()=>{var S;if(!m&&!r)return null;const l=n?r==null?void 0:r.productGiftWrapping.map(W=>({...W,price:r.giftWrappingPrice.value>0?r.giftWrappingPrice:W.price})):(m==null?void 0:m.cartGiftWrapping)||[],O=l==null?void 0:l.find(W=>W.selected),y=(O==null?void 0:O.uid)??((S=l[0])==null?void 0:S.uid),T=!!O,$=n?r==null?void 0:r.giftMessage:m==null?void 0:m.giftMessage,M=m==null?void 0:m.printedCardIncluded,re=m==null?void 0:m.giftReceiptIncluded;return G(!1),{...r!=null&&r.uid?{itemId:r.uid}:{},...n?{}:{printedCardIncluded:M,giftReceiptIncluded:re},...$,giftWrappingId:y,isGiftWrappingSelected:T,giftWrappingOptions:l}},[n,r,m]);le(()=>{if(!K)return;const{giftWrappingOptions:l}=K;P(O=>{const y=$=>$ in O,T=Object.keys(K).reduce(($,M)=>y(M)&&O[M]!==K[M]?{...$,[M]:K[M]}:$,{});return Object.keys(T).length>0?{...O,...T}:O}),l!=null&&l.length&&k(l)},[K]);const ve=Oe(()=>Object.entries(g).filter(([l])=>l!=="itemId"&&l!=="giftWrappingId").some(([,l])=>!!l),[g]);return{loading:F,giftOptions:g,showModal:C,errorsField:A,updateLoading:o,cartData:m,fieldsDisabled:u,isGiftOptionsApplied:ve,giftWrappingConfig:L,handleFormMouseLeave:D,onInputChange:Q,updateGiftOptions:j,setShowModal:z,handleBlur:ee}},lr=({item:r,view:i="order",readOnlyFormOrderView:c="primary",dataSource:a="cart",isEditable:t=!0,initialLoading:f=!0,handleItemsLoading:p,handleItemsError:n,onItemUpdate:h})=>{const{loading:F,giftOptions:G,showModal:o,errorsField:v,updateLoading:u,cartData:_,isGiftOptionsApplied:x,fieldsDisabled:N,giftWrappingConfig:s,handleFormMouseLeave:w,updateGiftOptions:C,setShowModal:z,onInputChange:L,handleBlur:k}=ze({item:r,view:i,dataSource:a,initialLoading:f,handleItemsLoading:p,handleItemsError:n,onItemUpdate:h});if(E.config){const{allowGiftWrappingOnOrder:m,allowGiftWrappingOnOrderItems:B,allowGiftMessageOnOrder:A,allowGiftMessageOnOrderItems:b,allowGiftReceipt:g,allowPrintedCard:P}=E.config;if(i==="product"&&!b&&!B&&!we(r,!0)||i==="order"&&!m&&!A&&!g&&!P)return null}return e(He,{item:r,view:i,loading:F,onBlur:k,giftOptions:G,showModal:o,isEditable:t,errorsField:v,setShowModal:z,updateLoading:u,updateGiftOptions:C,cartData:_,isGiftOptionsApplied:x,fieldsDisabled:N,giftWrappingConfig:s,handleFormMouseLeave:w,readOnlyFormOrderView:c,onInputChange:L})};export{lr as GiftOptions,lr as default};
