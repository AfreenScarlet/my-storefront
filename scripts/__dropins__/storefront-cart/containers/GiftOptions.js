/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as a,Fragment as k,jsx as t}from"@dropins/tools/preact-jsx-runtime.js";import{classes as Ce}from"@dropins/tools/lib.js";import{Modal as xe,Price as ce,ContentGrid as Ne,ImageSwatch as Pe,Button as se,Skeleton as be,SkeletonRow as Me,Field as U,Checkbox as le,Input as Oe,TextArea as We,Accordion as Ge,AccordionSection as ye,Icon as Q,Card as Te,ProgressSpinner as Re}from"@dropins/tools/components.js";/* empty css                   */import*as Y from"@dropins/tools/preact-compat.js";import{useState as M,useEffect as de,useCallback as Z,useMemo as he}from"@dropins/tools/preact-hooks.js";import{useText as X}from"@dropins/tools/i18n.js";import{s as $}from"../chunks/resetCart.js";import{S as Fe}from"../chunks/ChevronUp.js";import{S as we}from"../chunks/ChevronDown.js";import{events as Ve}from"@dropins/tools/event-bus.js";import{u as Se}from"../chunks/updateProductsFromCart.js";import{s as $e}from"../chunks/setGiftOptionsOnCart.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/persisted-data.js";import"../chunks/refreshCart.js";import"../fragments.js";import"../chunks/acdl.js";const oe=e=>Y.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},Y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),Y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),ae=e=>Y.createElement("svg",{width:20,height:23,viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},Y.createElement("path",{d:"M10 6L10 21.5M10 6H12.25C13.4926 6 14.5 4.99264 14.5 3.75C14.5 2.50736 13.4926 1.5 12.25 1.5C11.0074 1.5 10 2.50736 10 3.75M10 6V3.75M10 6H7.75C6.50736 6 5.5 4.99264 5.5 3.75C5.5 2.50736 6.50736 1.5 7.75 1.5C8.99264 1.5 10 2.50736 10 3.75M3.25 10.75H16.75C17.9926 10.75 19 9.74264 19 8.5C19 7.25736 17.9926 6.25 16.75 6.25H3.25C2.00736 6.25 1 7.25736 1 8.5C1 9.74264 2.00736 10.75 3.25 10.75ZM4.75 21.5H15.25C16.4926 21.5 17.5 20.4926 17.5 19.25V13.25C17.5 12.0074 16.4926 11 15.25 11H4.75C3.50736 11 2.5 12.0074 2.5 13.25V19.25C2.5 20.4926 3.50736 21.5 4.75 21.5Z",stroke:"currentColor",strokeWidth:1.5})),ke=({view:e,showModal:n,productName:c,giftWrappingConfig:o,setShowModal:r,updateGiftOptions:f})=>{var C;const d=X({modalTitle:"Cart.GiftOptions.modal.title",defaultTitle:"Cart.GiftOptions.modal.defaultTitle",modalWrappingText:"Cart.GiftOptions.modal.wrappingText",modalWrappingSubText:"Cart.GiftOptions.modal.wrappingSubText",modalConfirmButton:"Cart.GiftOptions.modal.modalConfirmButton",modalCancelButton:"Cart.GiftOptions.modal.modalCancelButton"}),[i,y]=M();if(de(()=>{y(o.find(l=>l.selected)??o[0])},[o]),!n||!o.length)return null;const p=c?`${d.modalTitle} ${c}`:d.defaultTitle;return a(xe,{"data-testid":`gift-option-modal-${e}`,className:"cart-gift-options-view__modal",size:"medium",title:a(k,{children:[t("span",{children:p}),i&&((C=i==null?void 0:i.price)==null?void 0:C.value)>0?t(ce,{amount:i.price.value,currency:i.price.currency,weight:"normal"}):null]}),centered:!0,onClose:()=>r(!1),children:[a("div",{className:"cart-gift-options-view__modal-content",children:[t("span",{className:"cart-gift-options-view__modal-text",children:d.modalWrappingText}),t(Ne,{emptyGridContent:t(k,{}),maxColumns:6,columnWidth:"100px",className:"cart-gift-options-view__modal-grid",children:o.map(l=>t(Pe,{selected:(i==null?void 0:i.uid)===(l==null?void 0:l.uid),onValue:()=>{y(l)},name:"giftWrappingId",value:l.uid,src:l.image.url,alt:l.image.design,label:l.image.design,className:"cart-gift-options-view__modal-grid-item"},l.uid))}),t("span",{className:"cart-gift-options-view__modal-sub-text",children:i==null?void 0:i.design})]}),t(se,{type:"button",onClick:()=>{f("giftWrappingId",i==null?void 0:i.uid,{giftOptionsWrap:!0}),r(!1)},children:d.modalConfirmButton}),t(se,{type:"button",variant:"secondary",onClick:()=>r(!1),children:d.modalCancelButton})]})},Ae=()=>t(be,{children:t(Me,{variant:"row",size:"small",fullWidth:!0,lines:1,multilineGap:"small"})}),ne={recipientName:"",senderName:"",message:""},Ee={giftReceiptIncluded:!1,printedCardIncluded:!1,isGiftWrappingSelected:!1},ve=(e,n)=>{var o,r;if(!n)return(o=$.config)==null?void 0:o.allowGiftMessageOnOrder;const c=((r=$.config)==null?void 0:r.allowGiftMessageOnOrderItems)??"";return typeof(e==null?void 0:e.giftMessageAvailable)=="boolean"?e==null?void 0:e.giftMessageAvailable:c},_e=e=>{const n={uid:"",design:"",selected:!1,image:{url:"",design:""},price:{currency:"USD",value:0}};return!e||e.length===0?n:(e==null?void 0:e.every(o=>!o.selected))?e[0]:e.find(o=>o.selected)||n},He=({className:e,view:n,item:c,giftOptions:o,disabled:r,onInputChange:f,cartData:d,giftWrappingConfig:i,setShowModal:y})=>{var E,b,K,D,ee,te,S,re;const p=X({customize:`Cart.GiftOptions.${n}.customize`,giftReceiptIncludedTitle:`Cart.GiftOptions.${n}.giftReceiptIncluded.title`,giftReceiptIncludedText:`Cart.GiftOptions.${n}.giftReceiptIncluded.subtitle`,printedCardIncludedTitle:`Cart.GiftOptions.${n}.printedCardIncluded.title`,printedCardIncludedText:`Cart.GiftOptions.${n}.printedCardIncluded.subtitle`,giftOptionsWrapTitle:`Cart.GiftOptions.${n}.giftOptionsWrap.title`,giftOptionsWrapText:`Cart.GiftOptions.${n}.giftOptionsWrap.subtitle`,requiredFieldError:"Cart.GiftOptions.formText.requiredFieldError"}),C=n==="product",l=(c==null?void 0:c.productGiftWrapping)??[],P=(d==null?void 0:d.cartGiftWrapping)??[],G=C?l:P,v=(E=d==null?void 0:d.items)==null?void 0:E.every(H=>H.giftWrappingAvailable),h=_e(G??[]),w=(h==null?void 0:h.design)??"",u=(b=$.config)==null?void 0:b.allowGiftWrappingOnOrder,_=(K=$.config)==null?void 0:K.allowGiftReceipt,W=(D=$.config)==null?void 0:D.allowPrintedCard,I=c==null?void 0:c.giftWrappingAvailable,A=c==null?void 0:c.giftWrappingPrice,z=C?!1:_,O=C?!1:W,L=C?I&&i.length:u&&i.length&&v,J=w?`${p.giftOptionsWrapText} ${w}`:"",B=+(((te=(ee=$.config)==null?void 0:ee.printedCardPrice)==null?void 0:te.value)??0)>0?(S=$.config)==null?void 0:S.printedCardPrice:null;let g=null;A!=null&&A.value?g=A:(re=h==null?void 0:h.price)!=null&&re.value&&(g=h.price);const q=!z&&!O&&!L,j=H=>H?a("span",{children:["Â (+",t(ce,{amount:H.value,currency:H.currency,weight:"normal"}),")"]}):null;return a("div",{className:Ce([e,[`${e}--hidden`,q]]),children:[z?t(U,{disabled:r,className:"cart-gift-options-view__field-gift-receipt",children:t(le,{disabled:r,name:"giftReceiptIncluded",checked:o.giftReceiptIncluded,placeholder:p.giftReceiptIncludedTitle,label:p.giftReceiptIncludedTitle,description:p.giftReceiptIncludedText,onChange:f})}):null,O?t(U,{disabled:r,className:"cart-gift-options-view__field-printed-card",children:t(le,{disabled:r,name:"printedCardIncluded",checked:o.printedCardIncluded,placeholder:p.printedCardIncludedTitle,label:a(k,{children:[p.printedCardIncludedTitle,j(B)]}),description:p.printedCardIncludedText,onChange:f})}):null,L?a(k,{children:[t(U,{disabled:r,className:"cart-gift-options-view__field-gift-wrap",children:t(le,{disabled:r,name:"isGiftWrappingSelected",checked:o.isGiftWrappingSelected,placeholder:p.giftOptionsWrapTitle,label:a(k,{children:[p.giftOptionsWrapTitle,j(g)]}),description:J,onChange:f})}),t(se,{disabled:r||!i.length,type:"button","data-testid":`gift-option-customize-${n}`,variant:"tertiary",onClick:()=>y(!0),children:p.customize})]}):null]})},Ie=({view:e,item:n,giftOptions:c,disabled:o,errorMessage:r,onInputChange:f,onBlur:d})=>{const i=X({formTitle:`Cart.GiftOptions.${e}.formContent.formTitle`,formTo:`Cart.GiftOptions.${e}.formContent.formTo`,formFrom:`Cart.GiftOptions.${e}.formContent.formFrom`,giftMessageTitle:`Cart.GiftOptions.${e}.formContent.giftMessageTitle`,formToPlaceholder:`Cart.GiftOptions.${e}.formContent.formToPlaceholder`,formFromPlaceholder:`Cart.GiftOptions.${e}.formContent.formFromPlaceholder`,formMessagePlaceholder:`Cart.GiftOptions.${e}.formContent.formMessagePlaceholder`});return ve(n,e==="product")?a(k,{children:[t("span",{children:i.formTitle}),a("div",{children:[t("span",{children:i.formTo}),t(U,{disabled:o,error:r.recipientName,children:t(Oe,{disabled:o,type:"text",name:"recipientName",value:c.recipientName,placeholder:i.formToPlaceholder,onChange:f,onBlur:d})})]}),a("div",{children:[t("span",{children:i.formFrom}),t(U,{disabled:o,error:r.senderName,children:t(Oe,{disabled:o,type:"text",name:"senderName",value:c.senderName,placeholder:i.formFromPlaceholder,onChange:f,onBlur:d})})]}),a("div",{children:[t("span",{children:i.giftMessageTitle}),t(U,{disabled:o,children:t(We,{errorMessage:r.message,disabled:o,name:"message",value:c.message,label:i.formMessagePlaceholder,onChange:f,onBlur:d})})]})]}):null},Be=({view:e,giftOptions:n,giftWrappingConfig:c,readOnlyFormOrderView:o})=>{const r=X({readOnlyProductTitle:"Cart.GiftOptions.product.readOnlyFormView.title",wrapping:"Cart.GiftOptions.product.readOnlyFormView.wrapping",recipient:"Cart.GiftOptions.product.readOnlyFormView.recipient",sender:"Cart.GiftOptions.product.readOnlyFormView.sender",message:"Cart.GiftOptions.product.readOnlyFormView.message",readOnlyOrderTitle:"Cart.GiftOptions.order.readOnlyFormView.title",readOnlyOrderGiftReceiptTitle:"Cart.GiftOptions.order.readOnlyFormView.giftReceipt",readOnlyOrderGiftReceiptText:"Cart.GiftOptions.order.readOnlyFormView.giftReceiptText",readOnlyOrderGiftPrintCardTitle:"Cart.GiftOptions.order.readOnlyFormView.printCard",readOnlyOrderGiftPrintCardText:"Cart.GiftOptions.order.readOnlyFormView.printCardText",readOnlyOrderGiftWrapTitle:"Cart.GiftOptions.order.readOnlyFormView.giftWrap",readOnlyOrderGiftWrapOptionsText:"Cart.GiftOptions.order.readOnlyFormView.giftWrapOptions",readOnlyOrderFormTitle:"Cart.GiftOptions.order.readOnlyFormView.formTitle",readOnlyOrderFormTo:"Cart.GiftOptions.order.readOnlyFormView.formTo",readOnlyOrderFormFrom:"Cart.GiftOptions.order.readOnlyFormView.formFrom",readOnlyOrderFormMessageTitle:"Cart.GiftOptions.order.readOnlyFormView.formMessageTitle"}),{recipientName:f,senderName:d,message:i,giftReceiptIncluded:y,printedCardIncluded:p,isGiftWrappingSelected:C}=n,l=_e(c),P=!!f||!!d||!!i,G=l==null?void 0:l.design,v=y||p||!!G,h=[{id:1,title:r.wrapping,message:C?G:""},{id:2,title:r.recipient,message:f},{id:3,title:r.sender,message:d},{id:4,title:r.message,message:i}],w=h.every(({message:u})=>!u);if(e==="product"&&!w)return t(Ge,{"data-testid":"gift-options-product",iconClose:Fe,iconOpen:we,actionIconPosition:"right",children:t(ye,{title:r.readOnlyProductTitle,showIconLeft:!0,iconLeft:ae,defaultOpen:!1,renderContentWhenClosed:!1,children:t("div",{children:h.filter(u=>u.message).map(u=>a("p",{children:[u.title," ",u.message]},u.id))})})});if(e==="order"&&(P||v)){const u=a("div",{className:"cart-gift-options-readonly__header",children:[t(Q,{source:ae,size:"24"}),t("span",{children:r.readOnlyOrderTitle})]}),_=a(k,{children:[y?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[t(Q,{source:oe,size:"16"}),t("p",{children:r.readOnlyOrderGiftReceiptTitle}),t("p",{children:r.readOnlyOrderGiftReceiptText})]}):null,p?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[t(Q,{source:oe,size:"16"}),t("p",{children:r.readOnlyOrderGiftPrintCardTitle}),t("p",{children:r.readOnlyOrderGiftPrintCardText})]}):null,l.selected?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[t(Q,{source:oe,size:"16"}),a("p",{children:[r.readOnlyOrderGiftWrapTitle," (+",t(ce,{amount:l.price.value,currency:l.price.currency,weight:"normal"}),")"]}),t("p",{children:`${r.readOnlyOrderGiftWrapOptionsText} ${l==null?void 0:l.design}`})]}):null]}),W=a("div",{className:"cart-gift-options-readonly__form",children:[t("div",{children:r.readOnlyOrderFormTitle}),a("div",{children:[a("p",{children:[t("span",{children:r.readOnlyOrderFormTo}),t("span",{children:f})]}),a("p",{children:[t("span",{children:r.readOnlyOrderFormFrom}),t("span",{children:d})]})]}),a("div",{children:[t("p",{children:r.readOnlyOrderFormMessageTitle}),t("p",{children:i})]})]});return a(Te,{variant:o,children:[u,_,W]})}return null},ze=({item:e,view:n,loading:c,giftOptions:o,showModal:r,isEditable:f,errorsField:d,updateLoading:i,cartData:y,fieldsDisabled:p,isGiftOptionsApplied:C,giftWrappingConfig:l,readOnlyFormOrderView:P,onBlur:G,setShowModal:v,updateGiftOptions:h,onInputChange:w,handleFormMouseLeave:u})=>{const _=X({accordionHeading:`Cart.GiftOptions.${n}.accordionHeading`}),W=Z(I=>t(Ge,{"data-testid":"gift-options-product",iconClose:Fe,iconOpen:we,actionIconPosition:"right",children:t(ye,{title:a("div",{className:"cart-gift-options-view__icon--success",children:[t("span",{children:_.accordionHeading}),C?t(Q,{source:oe,size:"16"}):null]}),showIconLeft:!0,iconLeft:ae,defaultOpen:C||I,renderContentWhenClosed:!0,children:a(k,{children:[t(He,{className:"cart-gift-options-view__top",view:n,item:e,giftOptions:o,disabled:p,onInputChange:w,cartData:y,giftWrappingConfig:l,setShowModal:v}),t("form",{className:"cart-gift-options-view__footer",onMouseLeave:u,children:t(Ie,{view:n,item:e,giftOptions:o,disabled:p,errorMessage:d,onInputChange:w,onBlur:G})})]})})}),[_.accordionHeading,C,n,e,o,p,w,y,l,v,u,d,G]);return a("div",{id:"cart-gift-options-view",className:Ce(["cart-gift-options-view",`cart-gift-options-view--${n}`,["cart-gift-options-view--loading",i]]),children:[i?t(Re,{className:"cart-gift-options-view__spinner"}):null,c?t(Ae,{}):a(k,{children:[f?null:t("div",{className:"cart-gift-options-view--readonly",children:t(Be,{view:n,giftOptions:o,giftWrappingConfig:l,readOnlyFormOrderView:P})}),t(ke,{view:n,productName:(e==null?void 0:e.name)??"",showModal:r,giftWrappingConfig:l,setShowModal:v,updateGiftOptions:h}),n==="product"&&f?W(!1):null,n==="order"&&f?t(Te,{variant:"secondary",children:W(!0)}):null]})]})},Le=({item:e,view:n,dataSource:c,initialLoading:o,handleItemsLoading:r,handleItemsError:f,onItemUpdate:d})=>{var H,fe,pe,ue,ge,me;const i=n==="product",y=X({requiredFieldError:"Cart.GiftOptions.formText.requiredFieldError"}),[p,C]=M(o),[l,P]=M(!1),[G,v]=M(!1),[h,w]=M(!1),[u,_]=M(!1),[W,I]=M(!1),[A,z]=M([]),[O,L]=M(null),[J,B]=M(ne),[g,q]=M(()=>({giftWrappingId:"",...ne,...Ee})),j=((H=g.recipientName)==null?void 0:H.trim())&&((fe=g.senderName)==null?void 0:fe.trim())&&((pe=g.message)==null?void 0:pe.trim()),E=!((ue=g.recipientName)!=null&&ue.trim())&&!((ge=g.senderName)!=null&&ge.trim())&&!((me=g.message)!=null&&me.trim()),b=Z(async s=>{switch(P(n==="order"),v(!0),n){case"product":{r==null||r(e.uid,!0),f==null||f(e.uid);const{recipientName:m,senderName:T,message:F,giftWrappingId:R,isGiftWrappingSelected:x}=s,ie={gift_message:{to:m||"",from:T||"",message:F||""},gift_wrapping_id:x?R:null};await Se([{uid:e.uid,quantity:e.quantity,giftOptions:ie}]).then(()=>{d==null||d({item:e})}).finally(()=>{r==null||r(e.uid,!1),v(!1),w(!1),P(!1)}).catch(V=>{console.warn(V)})}break;case"order":await $e(s).finally(()=>{v(!1),w(!1),P(!1)});break;default:console.error('Incorrect "view" prop value provided for GiftOptions container (storefront-cart)');break}},[f,r,e,d,n]),K=Z((s,m,T={})=>{q(F=>{const R=N=>N in F,x=N=>R(N)?F[N]:void 0;if(!(x(s)!==m||Object.keys(T).some(N=>x(N)!==T[N])))return F;const V={...F,[s]:m,...T};return!V.recipientName&&!V.senderName&&!V.message&&_(!0),(typeof m=="boolean"||["giftWrappingId","giftReceiptIncluded","printedCardIncluded"].includes(s))&&b(V),w(!0),V})},[b]),D=Z(async()=>{console.log("MOUSE LEAVE!",G),!G&&(E&&u&&(B(ne),_(!1),await b(g)),h&&j&&(_(!0),await b(g)))},[b,g,h,E,u,G]),ee=Z(async s=>{if(console.log("BLURR!",G),G)return;const{name:m,value:T}=s.target;B(F=>({...F,[m]:T.trim()?"":y.requiredFieldError})),E&&u&&(B(ne),_(!1),await b(g)),h&&j&&await b(g)},[b,y,g,h,E,u,G]),te=Z(s=>{const m=s.target.name,T=s.target,F=T.type==="checkbox"?T.checked:T.value;K(m,F)},[K]);de(()=>{if(i)return;const s=Ve.on(c==="cart"?"cart/data":"order/data",m=>{L(m)},{eager:!0});return()=>{s==null||s.off()}},[c,i]);const S=he(()=>{var V;if(!O&&!e)return null;const s=i?e==null?void 0:e.productGiftWrapping.map(N=>({...N,price:e.giftWrappingPrice.value>0?e.giftWrappingPrice:N.price})):(O==null?void 0:O.cartGiftWrapping)||[],m=s==null?void 0:s.find(N=>N.selected),T=(m==null?void 0:m.uid)??((V=s[0])==null?void 0:V.uid),F=!!m,R=i?e==null?void 0:e.giftMessage:O==null?void 0:O.giftMessage,x=O==null?void 0:O.printedCardIncluded,ie=O==null?void 0:O.giftReceiptIncluded;return C(!1),{...e!=null&&e.uid?{itemId:e.uid}:{},...i?{}:{printedCardIncluded:x,giftReceiptIncluded:ie},...R,giftWrappingId:T,isGiftWrappingSelected:F,giftWrappingOptions:s}},[i,e,O]);de(()=>{if(!S)return;const{giftWrappingOptions:s}=S;q(m=>{const T=R=>R in m,F=Object.keys(S).reduce((R,x)=>T(x)&&m[x]!==S[x]?{...R,[x]:S[x]}:R,{});return Object.keys(F).length>0?{...m,...F}:m}),s!=null&&s.length&&z(s)},[S]);const re=he(()=>Object.entries(g).filter(([s])=>s!=="itemId"&&s!=="giftWrappingId").some(([,s])=>!!s),[g]);return{loading:p,giftOptions:g,showModal:W,errorsField:J,updateLoading:l,cartData:O,fieldsDisabled:G,isGiftOptionsApplied:re,giftWrappingConfig:A,handleFormMouseLeave:D,onInputChange:te,updateGiftOptions:K,setShowModal:I,handleBlur:ee}},st=({item:e,view:n="order",readOnlyFormOrderView:c="primary",dataSource:o="cart",isEditable:r=!0,initialLoading:f=!0,handleItemsLoading:d,handleItemsError:i,onItemUpdate:y})=>{const{loading:p,giftOptions:C,showModal:l,errorsField:P,updateLoading:G,cartData:v,isGiftOptionsApplied:h,fieldsDisabled:w,giftWrappingConfig:u,handleFormMouseLeave:_,updateGiftOptions:W,setShowModal:I,onInputChange:A,handleBlur:z}=Le({item:e,view:n,dataSource:o,initialLoading:f,handleItemsLoading:d,handleItemsError:i,onItemUpdate:y});if($.config){const{allowGiftWrappingOnOrder:O,allowGiftWrappingOnOrderItems:L,allowGiftMessageOnOrder:J,allowGiftMessageOnOrderItems:B,allowGiftReceipt:g,allowPrintedCard:q}=$.config;if(n==="product"&&!B&&!L&&!ve(e,!0)||n==="order"&&!O&&!J&&!g&&!q)return null}return t(ze,{item:e,view:n,loading:p,onBlur:z,giftOptions:C,showModal:l,isEditable:r,errorsField:P,setShowModal:I,updateLoading:G,updateGiftOptions:W,cartData:v,isGiftOptionsApplied:h,fieldsDisabled:w,giftWrappingConfig:u,handleFormMouseLeave:_,readOnlyFormOrderView:c,onInputChange:A})};export{st as GiftOptions,st as default};
