/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as a,Fragment as k,jsx as r}from"@dropins/tools/preact-jsx-runtime.js";import{classes as Ce}from"@dropins/tools/lib.js";import{Modal as _e,Price as ce,ContentGrid as Pe,ImageSwatch as xe,Button as se,Skeleton as Me,SkeletonRow as Ne,Field as U,Checkbox as le,Input as Oe,TextArea as be,Accordion as Ge,AccordionSection as ye,Icon as Q,Card as Te,ProgressSpinner as Re}from"@dropins/tools/components.js";/* empty css                   */import*as Y from"@dropins/tools/preact-compat.js";import{useState as b,useEffect as de,useCallback as Z,useMemo as he}from"@dropins/tools/preact-hooks.js";import{useText as X}from"@dropins/tools/i18n.js";import{s as $}from"../chunks/resetCart.js";import{S as Fe}from"../chunks/ChevronUp.js";import{S as ve}from"../chunks/ChevronDown.js";import{events as Ve}from"@dropins/tools/event-bus.js";import{u as We}from"../chunks/updateProductsFromCart.js";import{s as Se}from"../chunks/setGiftOptionsOnCart.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/persisted-data.js";import"../chunks/refreshCart.js";import"../fragments.js";import"../chunks/acdl.js";const oe=e=>Y.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},Y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),Y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),ae=e=>Y.createElement("svg",{width:20,height:23,viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},Y.createElement("path",{d:"M10 6L10 21.5M10 6H12.25C13.4926 6 14.5 4.99264 14.5 3.75C14.5 2.50736 13.4926 1.5 12.25 1.5C11.0074 1.5 10 2.50736 10 3.75M10 6V3.75M10 6H7.75C6.50736 6 5.5 4.99264 5.5 3.75C5.5 2.50736 6.50736 1.5 7.75 1.5C8.99264 1.5 10 2.50736 10 3.75M3.25 10.75H16.75C17.9926 10.75 19 9.74264 19 8.5C19 7.25736 17.9926 6.25 16.75 6.25H3.25C2.00736 6.25 1 7.25736 1 8.5C1 9.74264 2.00736 10.75 3.25 10.75ZM4.75 21.5H15.25C16.4926 21.5 17.5 20.4926 17.5 19.25V13.25C17.5 12.0074 16.4926 11 15.25 11H4.75C3.50736 11 2.5 12.0074 2.5 13.25V19.25C2.5 20.4926 3.50736 21.5 4.75 21.5Z",stroke:"currentColor",strokeWidth:1.5})),$e=({view:e,showModal:i,productName:c,giftWrappingConfig:l,setShowModal:t,updateGiftOptions:f})=>{var C;const d=X({modalTitle:"Cart.GiftOptions.modal.title",defaultTitle:"Cart.GiftOptions.modal.defaultTitle",modalWrappingText:"Cart.GiftOptions.modal.wrappingText",modalWrappingSubText:"Cart.GiftOptions.modal.wrappingSubText",modalConfirmButton:"Cart.GiftOptions.modal.modalConfirmButton",modalCancelButton:"Cart.GiftOptions.modal.modalCancelButton"}),[n,G]=b();if(de(()=>{G(l.find(o=>o.selected)??l[0])},[l]),!i||!l.length)return null;const p=c?`${d.modalTitle} ${c}`:d.defaultTitle;return a(_e,{"data-testid":`gift-option-modal-${e}`,className:"cart-gift-options-view__modal",size:"medium",title:a(k,{children:[r("span",{children:p}),n&&((C=n==null?void 0:n.price)==null?void 0:C.value)>0?r(ce,{amount:n.price.value,currency:n.price.currency,weight:"normal"}):null]}),centered:!0,onClose:()=>t(!1),children:[a("div",{className:"cart-gift-options-view__modal-content",children:[r("span",{className:"cart-gift-options-view__modal-text",children:d.modalWrappingText}),r(Pe,{emptyGridContent:r(k,{}),maxColumns:6,columnWidth:"100px",className:"cart-gift-options-view__modal-grid",children:l.map(o=>r(xe,{selected:(n==null?void 0:n.uid)===(o==null?void 0:o.uid),onValue:()=>{G(o)},name:"giftWrappingId",value:o.uid,src:o.image.url,alt:o.image.design,label:o.image.design,className:"cart-gift-options-view__modal-grid-item"},o.uid))}),r("span",{className:"cart-gift-options-view__modal-sub-text",children:n==null?void 0:n.design})]}),r(se,{type:"button",onClick:()=>{f("giftWrappingId",n==null?void 0:n.uid,{giftOptionsWrap:!0}),t(!1)},children:d.modalConfirmButton}),r(se,{type:"button",variant:"secondary",onClick:()=>t(!1),children:d.modalCancelButton})]})},ke=()=>r(Me,{children:r(Ne,{variant:"row",size:"small",fullWidth:!0,lines:1,multilineGap:"small"})}),ne={recipientName:"",senderName:"",message:""},Ae={giftReceiptIncluded:!1,printedCardIncluded:!1,isGiftWrappingSelected:!1},we=(e,i)=>{var l,t;if(!i)return(l=$.config)==null?void 0:l.allowGiftMessageOnOrder;const c=((t=$.config)==null?void 0:t.allowGiftMessageOnOrderItems)??"";return typeof(e==null?void 0:e.giftMessageAvailable)=="boolean"?e==null?void 0:e.giftMessageAvailable:c},Ee=e=>{const i={uid:"",design:"",selected:!1,image:{url:"",design:""},price:{currency:"USD",value:0}};return!e||e.length===0?i:(e==null?void 0:e.every(l=>!l.selected))?e[0]:e.find(l=>l.selected)||i},Ie=({className:e,view:i,item:c,giftOptions:l,disabled:t,onInputChange:f,cartData:d,giftWrappingConfig:n,setShowModal:G})=>{var E,N,K,D,ee,re,S,te;const p=X({customize:`Cart.GiftOptions.${i}.customize`,giftReceiptIncludedTitle:`Cart.GiftOptions.${i}.giftReceiptIncluded.title`,giftReceiptIncludedText:`Cart.GiftOptions.${i}.giftReceiptIncluded.subtitle`,printedCardIncludedTitle:`Cart.GiftOptions.${i}.printedCardIncluded.title`,printedCardIncludedText:`Cart.GiftOptions.${i}.printedCardIncluded.subtitle`,giftOptionsWrapTitle:`Cart.GiftOptions.${i}.giftOptionsWrap.title`,giftOptionsWrapText:`Cart.GiftOptions.${i}.giftOptionsWrap.subtitle`,requiredFieldError:"Cart.GiftOptions.formText.requiredFieldError"}),C=i==="product",o=(c==null?void 0:c.productGiftWrapping)??[],_=(d==null?void 0:d.cartGiftWrapping)??[],y=C?o:_,v=(E=d==null?void 0:d.items)==null?void 0:E.every(I=>I.giftWrappingAvailable),h=Ee(y??[]),w=(h==null?void 0:h.design)??"",u=(N=$.config)==null?void 0:N.allowGiftWrappingOnOrder,P=(K=$.config)==null?void 0:K.allowGiftReceipt,R=(D=$.config)==null?void 0:D.allowPrintedCard,H=c==null?void 0:c.giftWrappingAvailable,A=c==null?void 0:c.giftWrappingPrice,z=C?!1:P,O=C?!1:R,L=C?H&&n.length:u&&n.length&&v,J=w?`${p.giftOptionsWrapText} ${w}`:"",B=+(((re=(ee=$.config)==null?void 0:ee.printedCardPrice)==null?void 0:re.value)??0)>0?(S=$.config)==null?void 0:S.printedCardPrice:null;let g=null;A!=null&&A.value?g=A:(te=h==null?void 0:h.price)!=null&&te.value&&(g=h.price);const q=!z&&!O&&!L,j=I=>I?a("span",{children:["Â (+",r(ce,{amount:I.value,currency:I.currency,weight:"normal"}),")"]}):null;return a("div",{className:Ce([e,[`${e}--hidden`,q]]),children:[z?r(U,{disabled:t,className:"cart-gift-options-view__field-gift-receipt",children:r(le,{disabled:t,name:"giftReceiptIncluded",checked:l.giftReceiptIncluded,placeholder:p.giftReceiptIncludedTitle,label:p.giftReceiptIncludedTitle,description:p.giftReceiptIncludedText,onChange:f})}):null,O?r(U,{disabled:t,className:"cart-gift-options-view__field-printed-card",children:r(le,{disabled:t,name:"printedCardIncluded",checked:l.printedCardIncluded,placeholder:p.printedCardIncludedTitle,label:a(k,{children:[p.printedCardIncludedTitle,j(B)]}),description:p.printedCardIncludedText,onChange:f})}):null,L?a(k,{children:[r(U,{disabled:t,className:"cart-gift-options-view__field-gift-wrap",children:r(le,{disabled:t,name:"isGiftWrappingSelected",checked:l.isGiftWrappingSelected,placeholder:p.giftOptionsWrapTitle,label:a(k,{children:[p.giftOptionsWrapTitle,j(g)]}),description:J,onChange:f})}),r(se,{disabled:t||!n.length,type:"button","data-testid":`gift-option-customize-${i}`,variant:"tertiary",onClick:()=>G(!0),children:p.customize})]}):null]})},He=({view:e,item:i,giftOptions:c,disabled:l,errorMessage:t,onInputChange:f,onBlur:d})=>{const n=X({formTitle:`Cart.GiftOptions.${e}.formContent.formTitle`,formTo:`Cart.GiftOptions.${e}.formContent.formTo`,formFrom:`Cart.GiftOptions.${e}.formContent.formFrom`,giftMessageTitle:`Cart.GiftOptions.${e}.formContent.giftMessageTitle`,formToPlaceholder:`Cart.GiftOptions.${e}.formContent.formToPlaceholder`,formFromPlaceholder:`Cart.GiftOptions.${e}.formContent.formFromPlaceholder`,formMessagePlaceholder:`Cart.GiftOptions.${e}.formContent.formMessagePlaceholder`});return we(i,e==="product")?a(k,{children:[r("span",{children:n.formTitle}),a("div",{children:[r("span",{children:n.formTo}),r(U,{disabled:l,error:t.recipientName,children:r(Oe,{disabled:l,type:"text",name:"recipientName",value:c.recipientName,placeholder:n.formToPlaceholder,onChange:f,onBlur:d})})]}),a("div",{children:[r("span",{children:n.formFrom}),r(U,{disabled:l,error:t.senderName,children:r(Oe,{disabled:l,type:"text",name:"senderName",value:c.senderName,placeholder:n.formFromPlaceholder,onChange:f,onBlur:d})})]}),a("div",{children:[r("span",{children:n.giftMessageTitle}),r(U,{disabled:l,children:r(be,{errorMessage:t.message,disabled:l,name:"message",value:c.message,label:n.formMessagePlaceholder,onChange:f,onBlur:d})})]})]}):null},Be=({view:e,giftOptions:i,giftWrappingConfig:c,readOnlyFormOrderView:l})=>{const t=X({readOnlyProductTitle:"Cart.GiftOptions.product.readOnlyFormView.title",wrapping:"Cart.GiftOptions.product.readOnlyFormView.wrapping",recipient:"Cart.GiftOptions.product.readOnlyFormView.recipient",sender:"Cart.GiftOptions.product.readOnlyFormView.sender",message:"Cart.GiftOptions.product.readOnlyFormView.message",readOnlyOrderTitle:"Cart.GiftOptions.order.readOnlyFormView.title",readOnlyOrderGiftReceiptTitle:"Cart.GiftOptions.order.readOnlyFormView.giftReceipt",readOnlyOrderGiftReceiptText:"Cart.GiftOptions.order.readOnlyFormView.giftReceiptText",readOnlyOrderGiftPrintCardTitle:"Cart.GiftOptions.order.readOnlyFormView.printCard",readOnlyOrderGiftPrintCardText:"Cart.GiftOptions.order.readOnlyFormView.printCardText",readOnlyOrderGiftWrapTitle:"Cart.GiftOptions.order.readOnlyFormView.giftWrap",readOnlyOrderGiftWrapOptionsText:"Cart.GiftOptions.order.readOnlyFormView.giftWrapOptions",readOnlyOrderFormTitle:"Cart.GiftOptions.order.readOnlyFormView.formTitle",readOnlyOrderFormTo:"Cart.GiftOptions.order.readOnlyFormView.formTo",readOnlyOrderFormFrom:"Cart.GiftOptions.order.readOnlyFormView.formFrom",readOnlyOrderFormMessageTitle:"Cart.GiftOptions.order.readOnlyFormView.formMessageTitle"}),{recipientName:f,senderName:d,message:n,giftReceiptIncluded:G,printedCardIncluded:p,isGiftWrappingSelected:C}=i,o=c.find(({uid:u})=>u===(i==null?void 0:i.giftWrappingId)),_=!!f||!!d||!!n,y=o==null?void 0:o.design,v=G||p||(o==null?void 0:o.selected),h=[{id:1,title:t.wrapping,message:C?y:""},{id:2,title:t.recipient,message:f},{id:3,title:t.sender,message:d},{id:4,title:t.message,message:n}],w=h.every(({message:u})=>!u);if(e==="product"&&!w)return r(Ge,{"data-testid":"gift-options-product",iconClose:Fe,iconOpen:ve,actionIconPosition:"right",children:r(ye,{title:t.readOnlyProductTitle,showIconLeft:!0,iconLeft:ae,defaultOpen:!1,renderContentWhenClosed:!1,children:r("div",{children:h.filter(u=>u.message).map(u=>a("p",{children:[u.title," ",u.message]},u.id))})})});if(console.log("giftWrapCart :>> ",o),console.log("isGiftMessageProvided :>> ",_),console.log("shouldRenderGiftOptions :>> ",v),e==="order"&&(_||v)){const u=a("div",{className:"cart-gift-options-readonly__header",children:[r(Q,{source:ae,size:"24"}),r("span",{children:t.readOnlyOrderTitle})]}),P=a(k,{children:[G?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[r(Q,{source:oe,size:"16"}),r("p",{children:t.readOnlyOrderGiftReceiptTitle}),r("p",{children:t.readOnlyOrderGiftReceiptText})]}):null,p?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[r(Q,{source:oe,size:"16"}),r("p",{children:t.readOnlyOrderGiftPrintCardTitle}),r("p",{children:t.readOnlyOrderGiftPrintCardText})]}):null,o!=null&&o.selected?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[r(Q,{source:oe,size:"16"}),a("p",{children:[t.readOnlyOrderGiftWrapTitle," (+",r(ce,{amount:o.price.value,currency:o.price.currency,weight:"normal"}),")"]}),r("p",{children:`${t.readOnlyOrderGiftWrapOptionsText} ${o==null?void 0:o.design}`})]}):null]}),R=_?a("div",{className:"cart-gift-options-readonly__form",children:[r("div",{children:t.readOnlyOrderFormTitle}),a("div",{children:[a("p",{children:[r("span",{children:t.readOnlyOrderFormTo}),r("span",{children:f})]}),a("p",{children:[r("span",{children:t.readOnlyOrderFormFrom}),r("span",{children:d})]})]}),a("div",{children:[r("p",{children:t.readOnlyOrderFormMessageTitle}),r("p",{children:n})]})]}):null;return a(Te,{variant:l,children:[u,P,R]})}return null},ze=({item:e,view:i,loading:c,giftOptions:l,showModal:t,isEditable:f,errorsField:d,updateLoading:n,cartData:G,fieldsDisabled:p,isGiftOptionsApplied:C,giftWrappingConfig:o,readOnlyFormOrderView:_,onBlur:y,setShowModal:v,updateGiftOptions:h,onInputChange:w,handleFormMouseLeave:u})=>{const P=X({accordionHeading:`Cart.GiftOptions.${i}.accordionHeading`}),R=Z(H=>r(Ge,{"data-testid":"gift-options-product",iconClose:Fe,iconOpen:ve,actionIconPosition:"right",children:r(ye,{title:a("div",{className:"cart-gift-options-view__icon--success",children:[r("span",{children:P.accordionHeading}),C?r(Q,{source:oe,size:"16"}):null]}),showIconLeft:!0,iconLeft:ae,defaultOpen:C||H,renderContentWhenClosed:!0,children:a(k,{children:[r(Ie,{className:"cart-gift-options-view__top",view:i,item:e,giftOptions:l,disabled:p,onInputChange:w,cartData:G,giftWrappingConfig:o,setShowModal:v}),r("form",{className:"cart-gift-options-view__footer",onMouseLeave:u,children:r(He,{view:i,item:e,giftOptions:l,disabled:p,errorMessage:d,onInputChange:w,onBlur:y})})]})})}),[P.accordionHeading,C,i,e,l,p,w,G,o,v,u,d,y]);return a("div",{id:"cart-gift-options-view",className:Ce(["cart-gift-options-view",`cart-gift-options-view--${i}`,["cart-gift-options-view--loading",n]]),children:[n?r(Re,{className:"cart-gift-options-view__spinner"}):null,c?r(ke,{}):a(k,{children:[f?null:r("div",{className:"cart-gift-options-view--readonly",children:r(Be,{view:i,giftOptions:l,giftWrappingConfig:o,readOnlyFormOrderView:_})}),r($e,{view:i,productName:(e==null?void 0:e.name)??"",showModal:t,giftWrappingConfig:o,setShowModal:v,updateGiftOptions:h}),i==="product"&&f?R(!1):null,i==="order"&&f?r(Te,{variant:"secondary",children:R(!0)}):null]})]})},Le=({item:e,view:i,dataSource:c,initialLoading:l,handleItemsLoading:t,handleItemsError:f,onItemUpdate:d})=>{var I,fe,pe,ue,ge,me;const n=i==="product",G=X({requiredFieldError:"Cart.GiftOptions.formText.requiredFieldError"}),[p,C]=b(l),[o,_]=b(!1),[y,v]=b(!1),[h,w]=b(!1),[u,P]=b(!1),[R,H]=b(!1),[A,z]=b([]),[O,L]=b(null),[J,B]=b(ne),[g,q]=b(()=>({giftWrappingId:"",...ne,...Ae})),j=((I=g.recipientName)==null?void 0:I.trim())&&((fe=g.senderName)==null?void 0:fe.trim())&&((pe=g.message)==null?void 0:pe.trim()),E=!((ue=g.recipientName)!=null&&ue.trim())&&!((ge=g.senderName)!=null&&ge.trim())&&!((me=g.message)!=null&&me.trim()),N=Z(async s=>{switch(_(i==="order"),v(!0),i){case"product":{t==null||t(e.uid,!0),f==null||f(e.uid);const{recipientName:m,senderName:T,message:F,giftWrappingId:V,isGiftWrappingSelected:x}=s,ie={gift_message:{to:m||"",from:T||"",message:F||""},gift_wrapping_id:x?V:null};await We([{uid:e.uid,quantity:e.quantity,giftOptions:ie}]).then(()=>{d==null||d({item:e})}).finally(()=>{t==null||t(e.uid,!1),v(!1),w(!1),_(!1)}).catch(W=>{console.warn(W)})}break;case"order":await Se(s).finally(()=>{v(!1),w(!1),_(!1)});break;default:console.error('Incorrect "view" prop value provided for GiftOptions container (storefront-cart)');break}},[f,t,e,d,i]),K=Z((s,m,T={})=>{q(F=>{const V=M=>M in F,x=M=>V(M)?F[M]:void 0;if(!(x(s)!==m||Object.keys(T).some(M=>x(M)!==T[M])))return F;const W={...F,[s]:m,...T};return!W.recipientName&&!W.senderName&&!W.message&&P(!0),(typeof m=="boolean"||["giftWrappingId","giftReceiptIncluded","printedCardIncluded"].includes(s))&&N(W),w(!0),W})},[N]),D=Z(async()=>{console.log("MOUSE LEAVE!",y),!y&&(E&&u&&(B(ne),P(!1),await N(g)),h&&j&&(P(!0),await N(g)))},[N,g,h,E,u,y]),ee=Z(async s=>{if(console.log("BLURR!",y),y)return;const{name:m,value:T}=s.target;B(F=>({...F,[m]:T.trim()?"":G.requiredFieldError})),E&&u&&(B(ne),P(!1),await N(g)),h&&j&&await N(g)},[N,G,g,h,E,u,y]),re=Z(s=>{const m=s.target.name,T=s.target,F=T.type==="checkbox"?T.checked:T.value;K(m,F)},[K]);de(()=>{if(n)return;const s=Ve.on(c==="cart"?"cart/data":"order/data",m=>{L(m)},{eager:!0});return()=>{s==null||s.off()}},[c,n]);const S=he(()=>{var W;if(!O&&!e)return null;const s=n?e==null?void 0:e.productGiftWrapping.map(M=>({...M,price:e.giftWrappingPrice.value>0?e.giftWrappingPrice:M.price})):(O==null?void 0:O.cartGiftWrapping)||[],m=s==null?void 0:s.find(M=>M.selected),T=(m==null?void 0:m.uid)??((W=s[0])==null?void 0:W.uid),F=!!m,V=n?e==null?void 0:e.giftMessage:O==null?void 0:O.giftMessage,x=O==null?void 0:O.printedCardIncluded,ie=O==null?void 0:O.giftReceiptIncluded;return C(!1),{...e!=null&&e.uid?{itemId:e.uid}:{},...n?{}:{printedCardIncluded:x,giftReceiptIncluded:ie},...V,giftWrappingId:T,isGiftWrappingSelected:F,giftWrappingOptions:s}},[n,e,O]);de(()=>{if(!S)return;const{giftWrappingOptions:s}=S;q(m=>{const T=V=>V in m,F=Object.keys(S).reduce((V,x)=>T(x)&&m[x]!==S[x]?{...V,[x]:S[x]}:V,{});return Object.keys(F).length>0?{...m,...F}:m}),s!=null&&s.length&&z(s)},[S]);const te=he(()=>Object.entries(g).filter(([s])=>s!=="itemId"&&s!=="giftWrappingId").some(([,s])=>!!s),[g]);return{loading:p,giftOptions:g,showModal:R,errorsField:J,updateLoading:o,cartData:O,fieldsDisabled:y,isGiftOptionsApplied:te,giftWrappingConfig:A,handleFormMouseLeave:D,onInputChange:re,updateGiftOptions:K,setShowModal:H,handleBlur:ee}},sr=({item:e,view:i="order",readOnlyFormOrderView:c="primary",dataSource:l="cart",isEditable:t=!0,initialLoading:f=!0,handleItemsLoading:d,handleItemsError:n,onItemUpdate:G})=>{const{loading:p,giftOptions:C,showModal:o,errorsField:_,updateLoading:y,cartData:v,isGiftOptionsApplied:h,fieldsDisabled:w,giftWrappingConfig:u,handleFormMouseLeave:P,updateGiftOptions:R,setShowModal:H,onInputChange:A,handleBlur:z}=Le({item:e,view:i,dataSource:l,initialLoading:f,handleItemsLoading:d,handleItemsError:n,onItemUpdate:G});if($.config){const{allowGiftWrappingOnOrder:O,allowGiftWrappingOnOrderItems:L,allowGiftMessageOnOrder:J,allowGiftMessageOnOrderItems:B,allowGiftReceipt:g,allowPrintedCard:q}=$.config;if(i==="product"&&!B&&!L&&!we(e,!0)||i==="order"&&!O&&!J&&!g&&!q)return null}return r(ze,{item:e,view:i,loading:p,onBlur:z,giftOptions:C,showModal:o,isEditable:t,errorsField:_,setShowModal:H,updateLoading:y,updateGiftOptions:R,cartData:v,isGiftOptionsApplied:h,fieldsDisabled:w,giftWrappingConfig:u,handleFormMouseLeave:P,readOnlyFormOrderView:c,onInputChange:A})};export{sr as GiftOptions,sr as default};
