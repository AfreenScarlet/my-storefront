/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as a,Fragment as A,jsx as e}from"@dropins/tools/preact-jsx-runtime.js";import{classes as Ce}from"@dropins/tools/lib.js";import{Modal as _e,Price as ce,ContentGrid as xe,ImageSwatch as Pe,Button as se,Skeleton as Me,SkeletonRow as be,Field as U,Checkbox as le,Input as Oe,TextArea as Ne,Accordion as Ge,AccordionSection as ye,Icon as Q,Card as Te,ProgressSpinner as We}from"@dropins/tools/components.js";/* empty css                   */import*as Y from"@dropins/tools/preact-compat.js";import{useState as N,useEffect as de,useCallback as Z,useMemo as he}from"@dropins/tools/preact-hooks.js";import{useText as X}from"@dropins/tools/i18n.js";import{s as k}from"../chunks/resetCart.js";import{S as Fe}from"../chunks/ChevronUp.js";import{S as we}from"../chunks/ChevronDown.js";import{events as Re}from"@dropins/tools/event-bus.js";import{u as Ve}from"../chunks/updateProductsFromCart.js";import{s as $e}from"../chunks/setGiftOptionsOnCart.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/persisted-data.js";import"../chunks/refreshCart.js";import"../fragments.js";import"../chunks/acdl.js";const oe=r=>Y.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},Y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),Y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),ae=r=>Y.createElement("svg",{width:20,height:23,viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},Y.createElement("path",{d:"M10 6L10 21.5M10 6H12.25C13.4926 6 14.5 4.99264 14.5 3.75C14.5 2.50736 13.4926 1.5 12.25 1.5C11.0074 1.5 10 2.50736 10 3.75M10 6V3.75M10 6H7.75C6.50736 6 5.5 4.99264 5.5 3.75C5.5 2.50736 6.50736 1.5 7.75 1.5C8.99264 1.5 10 2.50736 10 3.75M3.25 10.75H16.75C17.9926 10.75 19 9.74264 19 8.5C19 7.25736 17.9926 6.25 16.75 6.25H3.25C2.00736 6.25 1 7.25736 1 8.5C1 9.74264 2.00736 10.75 3.25 10.75ZM4.75 21.5H15.25C16.4926 21.5 17.5 20.4926 17.5 19.25V13.25C17.5 12.0074 16.4926 11 15.25 11H4.75C3.50736 11 2.5 12.0074 2.5 13.25V19.25C2.5 20.4926 3.50736 21.5 4.75 21.5Z",stroke:"currentColor",strokeWidth:1.5})),Se=({view:r,showModal:n,productName:c,giftWrappingConfig:l,setShowModal:t,updateGiftOptions:p})=>{var C;const d=X({modalTitle:"Cart.GiftOptions.modal.title",defaultTitle:"Cart.GiftOptions.modal.defaultTitle",modalWrappingText:"Cart.GiftOptions.modal.wrappingText",modalWrappingSubText:"Cart.GiftOptions.modal.wrappingSubText",modalConfirmButton:"Cart.GiftOptions.modal.modalConfirmButton",modalCancelButton:"Cart.GiftOptions.modal.modalCancelButton"}),[i,G]=N();if(de(()=>{G(l.find(o=>o.selected)??l[0])},[l]),!n||!l.length)return null;const f=c?`${d.modalTitle} ${c}`:d.defaultTitle;return a(_e,{"data-testid":`gift-option-modal-${r}`,className:"cart-gift-options-view__modal",size:"medium",title:a(A,{children:[e("span",{children:f}),i&&((C=i==null?void 0:i.price)==null?void 0:C.value)>0?e(ce,{amount:i.price.value,currency:i.price.currency,weight:"normal"}):null]}),centered:!0,onClose:()=>t(!1),children:[a("div",{className:"cart-gift-options-view__modal-content",children:[e("span",{className:"cart-gift-options-view__modal-text",children:d.modalWrappingText}),e(xe,{emptyGridContent:e(A,{}),maxColumns:6,columnWidth:"100px",className:"cart-gift-options-view__modal-grid",children:l.map(o=>e(Pe,{selected:(i==null?void 0:i.uid)===(o==null?void 0:o.uid),onValue:()=>{G(o)},name:"giftWrappingId",value:o.uid,src:o.image.url,alt:o.image.design,label:o.image.design,className:"cart-gift-options-view__modal-grid-item"},o.uid))}),e("span",{className:"cart-gift-options-view__modal-sub-text",children:i==null?void 0:i.design})]}),e(se,{type:"button",onClick:()=>{p("giftWrappingId",i==null?void 0:i.uid,{giftOptionsWrap:!0}),t(!1)},children:d.modalConfirmButton}),e(se,{type:"button",variant:"secondary",onClick:()=>t(!1),children:d.modalCancelButton})]})},ke=()=>e(Me,{children:e(be,{variant:"row",size:"small",fullWidth:!0,lines:1,multilineGap:"small"})}),Ae=({className:r,view:n,item:c,giftOptions:l,disabled:t,onInputChange:p,cartData:d,giftWrappingConfig:i,setShowModal:G})=>{var I,b,K,D,ee,re,S,te;const f=X({customize:`Cart.GiftOptions.${n}.customize`,giftReceiptIncludedTitle:`Cart.GiftOptions.${n}.giftReceiptIncluded.title`,giftReceiptIncludedText:`Cart.GiftOptions.${n}.giftReceiptIncluded.subtitle`,printedCardIncludedTitle:`Cart.GiftOptions.${n}.printedCardIncluded.title`,printedCardIncludedText:`Cart.GiftOptions.${n}.printedCardIncluded.subtitle`,giftOptionsWrapTitle:`Cart.GiftOptions.${n}.giftOptionsWrap.title`,giftOptionsWrapText:`Cart.GiftOptions.${n}.giftOptionsWrap.subtitle`,requiredFieldError:"Cart.GiftOptions.formText.requiredFieldError"}),C=n==="product",o=(c==null?void 0:c.productGiftWrapping)??[],x=(d==null?void 0:d.cartGiftWrapping)??[],y=C?o:x,v=(I=d==null?void 0:d.items)==null?void 0:I.every(R=>R.giftWrappingAvailable),h=y.find(R=>R.uid===l.giftWrappingId),w=(h==null?void 0:h.design)??"",u=(b=k.config)==null?void 0:b.allowGiftWrappingOnOrder,_=(K=k.config)==null?void 0:K.allowGiftReceipt,W=(D=k.config)==null?void 0:D.allowPrintedCard,H=c==null?void 0:c.giftWrappingAvailable,E=c==null?void 0:c.giftWrappingPrice,z=C?!1:_,O=C?!1:W,L=C?H&&i.length:u&&i.length&&v,J=w?`${f.giftOptionsWrapText} ${w}`:"",B=+(((re=(ee=k.config)==null?void 0:ee.printedCardPrice)==null?void 0:re.value)??0)>0?(S=k.config)==null?void 0:S.printedCardPrice:null;let g=null;E!=null&&E.value?g=E:(te=h==null?void 0:h.price)!=null&&te.value&&(g=h.price);const q=!z&&!O&&!L,j=R=>R?a("span",{children:["Â (+",e(ce,{amount:R.value,currency:R.currency,weight:"normal"}),")"]}):null;return a("div",{className:Ce([r,[`${r}--hidden`,q]]),children:[z?e(U,{disabled:t,className:"cart-gift-options-view__field-gift-receipt",children:e(le,{disabled:t,name:"giftReceiptIncluded",checked:l.giftReceiptIncluded,placeholder:f.giftReceiptIncludedTitle,label:f.giftReceiptIncludedTitle,description:f.giftReceiptIncludedText,onChange:p})}):null,O?e(U,{disabled:t,className:"cart-gift-options-view__field-printed-card",children:e(le,{disabled:t,name:"printedCardIncluded",checked:l.printedCardIncluded,placeholder:f.printedCardIncludedTitle,label:a(A,{children:[f.printedCardIncludedTitle,j(B)]}),description:f.printedCardIncludedText,onChange:p})}):null,L?a(A,{children:[e(U,{disabled:t,className:"cart-gift-options-view__field-gift-wrap",children:e(le,{disabled:t,name:"isGiftWrappingSelected",checked:l.isGiftWrappingSelected,placeholder:f.giftOptionsWrapTitle,label:a(A,{children:[f.giftOptionsWrapTitle,j(g)]}),description:J,onChange:p})}),e(se,{disabled:t||!i.length,type:"button","data-testid":`gift-option-customize-${n}`,variant:"tertiary",onClick:()=>G(!0),children:f.customize})]}):null]})},ne={recipientName:"",senderName:"",message:""},Ee={giftReceiptIncluded:!1,printedCardIncluded:!1,isGiftWrappingSelected:!1},ve=(r,n)=>{var l,t;if(!n)return(l=k.config)==null?void 0:l.allowGiftMessageOnOrder;const c=((t=k.config)==null?void 0:t.allowGiftMessageOnOrderItems)??"";return typeof(r==null?void 0:r.giftMessageAvailable)=="boolean"?r==null?void 0:r.giftMessageAvailable:c},Ie=({view:r,item:n,giftOptions:c,disabled:l,errorMessage:t,onInputChange:p,onBlur:d})=>{const i=X({formTitle:`Cart.GiftOptions.${r}.formContent.formTitle`,formTo:`Cart.GiftOptions.${r}.formContent.formTo`,formFrom:`Cart.GiftOptions.${r}.formContent.formFrom`,giftMessageTitle:`Cart.GiftOptions.${r}.formContent.giftMessageTitle`,formToPlaceholder:`Cart.GiftOptions.${r}.formContent.formToPlaceholder`,formFromPlaceholder:`Cart.GiftOptions.${r}.formContent.formFromPlaceholder`,formMessagePlaceholder:`Cart.GiftOptions.${r}.formContent.formMessagePlaceholder`});return ve(n,r==="product")?a(A,{children:[e("span",{children:i.formTitle}),a("div",{children:[e("span",{children:i.formTo}),e(U,{disabled:l,error:t.recipientName,children:e(Oe,{disabled:l,type:"text",name:"recipientName",value:c.recipientName,placeholder:i.formToPlaceholder,onChange:p,onBlur:d})})]}),a("div",{children:[e("span",{children:i.formFrom}),e(U,{disabled:l,error:t.senderName,children:e(Oe,{disabled:l,type:"text",name:"senderName",value:c.senderName,placeholder:i.formFromPlaceholder,onChange:p,onBlur:d})})]}),a("div",{children:[e("span",{children:i.giftMessageTitle}),e(U,{disabled:l,children:e(Ne,{errorMessage:t.message,disabled:l,name:"message",value:c.message,label:i.formMessagePlaceholder,onChange:p,onBlur:d})})]})]}):null},He=({view:r,giftOptions:n,giftWrappingConfig:c,readOnlyFormOrderView:l})=>{const t=X({readOnlyProductTitle:"Cart.GiftOptions.product.readOnlyFormView.title",wrapping:"Cart.GiftOptions.product.readOnlyFormView.wrapping",recipient:"Cart.GiftOptions.product.readOnlyFormView.recipient",sender:"Cart.GiftOptions.product.readOnlyFormView.sender",message:"Cart.GiftOptions.product.readOnlyFormView.message",readOnlyOrderTitle:"Cart.GiftOptions.order.readOnlyFormView.title",readOnlyOrderGiftReceiptTitle:"Cart.GiftOptions.order.readOnlyFormView.giftReceipt",readOnlyOrderGiftReceiptText:"Cart.GiftOptions.order.readOnlyFormView.giftReceiptText",readOnlyOrderGiftPrintCardTitle:"Cart.GiftOptions.order.readOnlyFormView.printCard",readOnlyOrderGiftPrintCardText:"Cart.GiftOptions.order.readOnlyFormView.printCardText",readOnlyOrderGiftWrapTitle:"Cart.GiftOptions.order.readOnlyFormView.giftWrap",readOnlyOrderGiftWrapOptionsText:"Cart.GiftOptions.order.readOnlyFormView.giftWrapOptions",readOnlyOrderFormTitle:"Cart.GiftOptions.order.readOnlyFormView.formTitle",readOnlyOrderFormTo:"Cart.GiftOptions.order.readOnlyFormView.formTo",readOnlyOrderFormFrom:"Cart.GiftOptions.order.readOnlyFormView.formFrom",readOnlyOrderFormMessageTitle:"Cart.GiftOptions.order.readOnlyFormView.formMessageTitle"}),{recipientName:p,senderName:d,message:i,giftReceiptIncluded:G,printedCardIncluded:f,isGiftWrappingSelected:C}=n,o=c.find(({uid:u})=>u===(n==null?void 0:n.giftWrappingId)),x=!!p||!!d||!!i,y=o==null?void 0:o.design,v=G||f||(o==null?void 0:o.selected),h=[{id:1,title:t.wrapping,message:C?y:""},{id:2,title:t.recipient,message:p},{id:3,title:t.sender,message:d},{id:4,title:t.message,message:i}],w=h.every(({message:u})=>!u);if(r==="product"&&!w)return e(Ge,{"data-testid":"gift-options-product",iconClose:Fe,iconOpen:we,actionIconPosition:"right",children:e(ye,{title:t.readOnlyProductTitle,showIconLeft:!0,iconLeft:ae,defaultOpen:!1,renderContentWhenClosed:!1,children:e("div",{children:h.filter(u=>u.message).map(u=>a("p",{children:[u.title," ",u.message]},u.id))})})});if(r==="order"&&(x||v)){const u=a("div",{className:"cart-gift-options-readonly__header",children:[e(Q,{source:ae,size:"24"}),e("span",{children:t.readOnlyOrderTitle})]}),_=a(A,{children:[G?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[e(Q,{source:oe,size:"16"}),e("p",{children:t.readOnlyOrderGiftReceiptTitle}),e("p",{children:t.readOnlyOrderGiftReceiptText})]}):null,f?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[e(Q,{source:oe,size:"16"}),e("p",{children:t.readOnlyOrderGiftPrintCardTitle}),e("p",{children:t.readOnlyOrderGiftPrintCardText})]}):null,o!=null&&o.selected?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[e(Q,{source:oe,size:"16"}),a("p",{children:[t.readOnlyOrderGiftWrapTitle," (+",e(ce,{amount:o.price.value,currency:o.price.currency,weight:"normal"}),")"]}),e("p",{children:`${t.readOnlyOrderGiftWrapOptionsText} ${o==null?void 0:o.design}`})]}):null]}),W=x?a("div",{className:"cart-gift-options-readonly__form",children:[e("div",{children:t.readOnlyOrderFormTitle}),a("div",{children:[a("p",{children:[e("span",{children:t.readOnlyOrderFormTo}),e("span",{children:p})]}),a("p",{children:[e("span",{children:t.readOnlyOrderFormFrom}),e("span",{children:d})]})]}),a("div",{children:[e("p",{children:t.readOnlyOrderFormMessageTitle}),e("p",{children:i})]})]}):null;return a(Te,{variant:l,children:[u,_,W]})}return null},Be=({item:r,view:n,loading:c,giftOptions:l,showModal:t,isEditable:p,errorsField:d,updateLoading:i,cartData:G,fieldsDisabled:f,isGiftOptionsApplied:C,giftWrappingConfig:o,readOnlyFormOrderView:x,onBlur:y,setShowModal:v,updateGiftOptions:h,onInputChange:w,handleFormMouseLeave:u})=>{const _=X({accordionHeading:`Cart.GiftOptions.${n}.accordionHeading`}),W=Z(H=>e(Ge,{"data-testid":"gift-options-product",iconClose:Fe,iconOpen:we,actionIconPosition:"right",children:e(ye,{title:a("div",{className:"cart-gift-options-view__icon--success",children:[e("span",{children:_.accordionHeading}),C?e(Q,{source:oe,size:"16"}):null]}),showIconLeft:!0,iconLeft:ae,defaultOpen:C||H,renderContentWhenClosed:!0,children:a(A,{children:[e(Ae,{className:"cart-gift-options-view__top",view:n,item:r,giftOptions:l,disabled:f,onInputChange:w,cartData:G,giftWrappingConfig:o,setShowModal:v}),e("form",{className:"cart-gift-options-view__footer",onMouseLeave:u,children:e(Ie,{view:n,item:r,giftOptions:l,disabled:f,errorMessage:d,onInputChange:w,onBlur:y})})]})})}),[_.accordionHeading,C,n,r,l,f,w,G,o,v,u,d,y]);return a("div",{id:"cart-gift-options-view",className:Ce(["cart-gift-options-view",`cart-gift-options-view--${n}`,["cart-gift-options-view--loading",i]]),children:[i?e(We,{className:"cart-gift-options-view__spinner"}):null,c?e(ke,{}):a(A,{children:[p?null:e("div",{className:"cart-gift-options-view--readonly",children:e(He,{view:n,giftOptions:l,giftWrappingConfig:o,readOnlyFormOrderView:x})}),e(Se,{view:n,productName:(r==null?void 0:r.name)??"",showModal:t,giftWrappingConfig:o,setShowModal:v,updateGiftOptions:h}),n==="product"&&p?W(!1):null,n==="order"&&p?e(Te,{variant:"secondary",children:W(!0)}):null]})]})},ze=({item:r,view:n,dataSource:c,initialLoading:l,handleItemsLoading:t,handleItemsError:p,onItemUpdate:d})=>{var R,pe,fe,ue,ge,me;const i=n==="product",G=X({requiredFieldError:"Cart.GiftOptions.formText.requiredFieldError"}),[f,C]=N(l),[o,x]=N(!1),[y,v]=N(!1),[h,w]=N(!1),[u,_]=N(!1),[W,H]=N(!1),[E,z]=N([]),[O,L]=N(null),[J,B]=N(ne),[g,q]=N(()=>({giftWrappingId:"",...ne,...Ee})),j=((R=g.recipientName)==null?void 0:R.trim())&&((pe=g.senderName)==null?void 0:pe.trim())&&((fe=g.message)==null?void 0:fe.trim()),I=!((ue=g.recipientName)!=null&&ue.trim())&&!((ge=g.senderName)!=null&&ge.trim())&&!((me=g.message)!=null&&me.trim()),b=Z(async s=>{switch(x(n==="order"),v(!0),n){case"product":{t==null||t(r.uid,!0),p==null||p(r.uid);const{recipientName:m,senderName:T,message:F,giftWrappingId:V,isGiftWrappingSelected:P}=s,ie={gift_message:{to:m||"",from:T||"",message:F||""},gift_wrapping_id:P?V:null};await Ve([{uid:r.uid,quantity:r.quantity,giftOptions:ie}]).then(()=>{d==null||d({item:r})}).finally(()=>{t==null||t(r.uid,!1),v(!1),w(!1),x(!1)}).catch($=>{console.warn($)})}break;case"order":await $e(s).finally(()=>{v(!1),w(!1),x(!1)});break;default:console.error('Incorrect "view" prop value provided for GiftOptions container (storefront-cart)');break}},[p,t,r,d,n]),K=Z((s,m,T={})=>{q(F=>{const V=M=>M in F,P=M=>V(M)?F[M]:void 0;if(!(P(s)!==m||Object.keys(T).some(M=>P(M)!==T[M])))return F;const $={...F,[s]:m,...T};return!$.recipientName&&!$.senderName&&!$.message&&_(!0),(typeof m=="boolean"||["giftWrappingId","giftReceiptIncluded","printedCardIncluded"].includes(s))&&b($),w(!0),$})},[b]),D=Z(async()=>{console.log("MOUSE LEAVE!",y),!y&&(I&&u&&(B(ne),_(!1),await b(g)),h&&j&&(_(!0),await b(g)))},[b,g,h,I,u,y]),ee=Z(async s=>{if(console.log("BLURR!",y),y)return;const{name:m,value:T}=s.target;B(F=>({...F,[m]:T.trim()?"":G.requiredFieldError})),I&&u&&(B(ne),_(!1),await b(g)),h&&j&&await b(g)},[b,G,g,h,I,u,y]),re=Z(s=>{const m=s.target.name,T=s.target,F=T.type==="checkbox"?T.checked:T.value;K(m,F)},[K]);de(()=>{if(i)return;const s=Re.on(c==="cart"?"cart/data":"order/data",m=>{L(m)},{eager:!0});return()=>{s==null||s.off()}},[c,i]);const S=he(()=>{var $;if(!O&&!r)return null;const s=i?r==null?void 0:r.productGiftWrapping.map(M=>({...M,price:r.giftWrappingPrice.value>0?r.giftWrappingPrice:M.price})):(O==null?void 0:O.cartGiftWrapping)||[],m=s==null?void 0:s.find(M=>M.selected),T=(m==null?void 0:m.uid)??(($=s[0])==null?void 0:$.uid),F=!!m,V=i?r==null?void 0:r.giftMessage:O==null?void 0:O.giftMessage,P=O==null?void 0:O.printedCardIncluded,ie=O==null?void 0:O.giftReceiptIncluded;return C(!1),{...r!=null&&r.uid?{itemId:r.uid}:{},...i?{}:{printedCardIncluded:P,giftReceiptIncluded:ie},...V,giftWrappingId:T,isGiftWrappingSelected:F,giftWrappingOptions:s}},[i,r,O]);de(()=>{if(!S)return;const{giftWrappingOptions:s}=S;q(m=>{const T=V=>V in m,F=Object.keys(S).reduce((V,P)=>T(P)&&m[P]!==S[P]?{...V,[P]:S[P]}:V,{});return Object.keys(F).length>0?{...m,...F}:m}),s!=null&&s.length&&z(s)},[S]);const te=he(()=>Object.entries(g).filter(([s])=>s!=="itemId"&&s!=="giftWrappingId").some(([,s])=>!!s),[g]);return{loading:f,giftOptions:g,showModal:W,errorsField:J,updateLoading:o,cartData:O,fieldsDisabled:y,isGiftOptionsApplied:te,giftWrappingConfig:E,handleFormMouseLeave:D,onInputChange:re,updateGiftOptions:K,setShowModal:H,handleBlur:ee}},lr=({item:r,view:n="order",readOnlyFormOrderView:c="primary",dataSource:l="cart",isEditable:t=!0,initialLoading:p=!0,handleItemsLoading:d,handleItemsError:i,onItemUpdate:G})=>{const{loading:f,giftOptions:C,showModal:o,errorsField:x,updateLoading:y,cartData:v,isGiftOptionsApplied:h,fieldsDisabled:w,giftWrappingConfig:u,handleFormMouseLeave:_,updateGiftOptions:W,setShowModal:H,onInputChange:E,handleBlur:z}=ze({item:r,view:n,dataSource:l,initialLoading:p,handleItemsLoading:d,handleItemsError:i,onItemUpdate:G});if(k.config){const{allowGiftWrappingOnOrder:O,allowGiftWrappingOnOrderItems:L,allowGiftMessageOnOrder:J,allowGiftMessageOnOrderItems:B,allowGiftReceipt:g,allowPrintedCard:q}=k.config;if(n==="product"&&!B&&!L&&!ve(r,!0)||n==="order"&&!O&&!J&&!g&&!q)return null}return e(Be,{item:r,view:n,loading:f,onBlur:z,giftOptions:C,showModal:o,isEditable:t,errorsField:x,setShowModal:H,updateLoading:y,updateGiftOptions:W,cartData:v,isGiftOptionsApplied:h,fieldsDisabled:w,giftWrappingConfig:u,handleFormMouseLeave:_,readOnlyFormOrderView:c,onInputChange:E})};export{lr as GiftOptions,lr as default};
