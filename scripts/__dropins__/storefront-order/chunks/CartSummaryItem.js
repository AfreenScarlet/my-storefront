import{jsx as v,jsxs as Q,Fragment as S}from"@dropins/tools/preact-jsx-runtime.js";import{Price as o,CartItem as c,Icon as d,Image as C,Incrementer as p}from"@dropins/tools/components.js";import{useCallback as ee}from"@dropins/tools/preact-hooks.js";import{classes as I}from"@dropins/tools/lib.js";import*as x from"@dropins/tools/preact-compat.js";const se=m=>x.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...m},x.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),x.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),g=["REJECTED","PARTIALLY_REJECTED","DENIED","UNCONFIRMED","CLOSED"],me=m=>{const e=m==null?void 0:m.returns.filter(n=>!g.includes(n.returnStatus)),f=((m==null?void 0:m.itemsEligibleForReturn)??[]).flatMap(n=>{let a=n.quantityShipped,i={...n,returnableQuantity:a};return n.quantityShipped===0&&(i={...i,eligibleForReturn:!1,returnableQuantity:0}),e.forEach(k=>{k.items.forEach(E=>{if((E==null?void 0:E.id)===(n==null?void 0:n.id)){const u=a-E.requestQuantity;a=Math.max(u,0),i={...i,eligibleForReturn:a!==0,returnableQuantity:a}}})}),i}).sort((n,a)=>Number(a.eligibleForReturn)-Number(n.eligibleForReturn));return console.log("212121",f),f},ie=m=>{var f;let e=[];return((f=m==null?void 0:m.returns)==null?void 0:f.filter(n=>!g.includes(n.returnStatus)).map(n=>{let a={};return n.items.forEach(i=>{a={...i}}),a})).forEach(n=>{if(!e.length)e.push({...n,totalQuantity:n.requestQuantity});else{const a=e.findIndex(i=>i.id===n.id);a!==-1?e[a].totalQuantity+=n.requestQuantity:e.push({...n,totalQuantity:n.requestQuantity})}}),console.log("returnedList",e),e},he=({loading:m,product:e,itemType:w,taxConfig:f,translations:n,disabledIncrementer:a,showConfigurableOptions:i,onQuantity:k,routeProductDetails:E,isReturnProductList:u})=>{var V,D,j,A,H,O,Z,z,J,W,$,B,K,U,Y,G,X;const{taxExcluded:F,taxIncluded:_}=f,y=ee((b,T,r)=>v(o,{amount:b,currency:T,weight:"normal",...r}),[]);let L={};const q=w==="cancelled",P=(D=(V=e==null?void 0:e.product)==null?void 0:V.stockStatus)==null?void 0:D.includes("IN_STOCK"),s=(e==null?void 0:e.giftCard)||{},l=(j=e==null?void 0:e.itemPrices)==null?void 0:j.priceIncludingTax,t=(A=e==null?void 0:e.itemPrices)==null?void 0:A.originalPrice,h=(H=e==null?void 0:e.itemPrices)==null?void 0:H.price,R=w==="returned"?e==null?void 0:e.requestQuantity:e==null?void 0:e.totalQuantity,N=e.discounted&&((O=e.price)==null?void 0:O.value)!==(t==null?void 0:t.value)*R,M={..."configurableOptions"in e?e.configurableOptions:{},..."bundleOptions"in e?e.bundleOptions:{},..."senderName"in s&&(s!=null&&s.senderName)?{[n.sender]:s==null?void 0:s.senderName}:{},..."senderEmail"in s&&(s!=null&&s.senderEmail)?{[n.sender]:s==null?void 0:s.senderEmail}:{},..."recipientName"in s&&(s!=null&&s.recipientName)?{[n.recipient]:s==null?void 0:s.recipientName}:{},..."recipientEmail"in s&&(s!=null&&s.recipientEmail)?{[n.recipient]:s==null?void 0:s.recipientEmail}:{},..."message"in s&&(s!=null&&s.message)?{[n.message]:s==null?void 0:s.message}:{},..."downloadableLinks"in e&&(e!=null&&e.downloadableLinks)?{[`${(Z=e==null?void 0:e.downloadableLinks)==null?void 0:Z.count} ${n.downloadableCount}`]:(z=e==null?void 0:e.downloadableLinks)==null?void 0:z.result}:{}};if(_&&F){const b=N?t==null?void 0:t.value:(l==null?void 0:l.value)*R;L={taxExcluded:!0,taxIncluded:void 0,price:y(t==null?void 0:t.value,t==null?void 0:t.currency),total:Q(S,{children:[y(b,t==null?void 0:t.currency,{variant:e.discounted&&(l==null?void 0:l.value)!==b?"strikethrough":"default"}),e.discounted&&(l==null?void 0:l.value)!==b?y(l==null?void 0:l.value,l==null?void 0:l.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:y((h==null?void 0:h.value)*R,h==null?void 0:h.currency)}}else if(!_&&F)L={taxExcluded:void 0,taxIncluded:void 0,price:y(t==null?void 0:t.value,t==null?void 0:t.currency),total:Q(S,{children:[y((t==null?void 0:t.value)*R,l==null?void 0:l.currency,{variant:N?"strikethrough":"default"}),N?y((J=e.price)==null?void 0:J.value,(W=e.price)==null?void 0:W.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:y((h==null?void 0:h.value)*(e==null?void 0:e.totalQuantity),h==null?void 0:h.currency)};else if(_&&!F){const b=N?t.value:l.value*R;L={taxExcluded:void 0,taxIncluded:!0,price:y(l==null?void 0:l.value,l==null?void 0:l.currency),total:Q(S,{children:[y(b,l==null?void 0:l.currency,{variant:N?"strikethrough":"default",weight:"bold"}),N?y(l==null?void 0:l.value,l==null?void 0:l.currency,{sale:!0,weight:"bold"}):null]})}}return v(c,{loading:m,alert:q&&P?Q("span",{children:[v(d,{source:se}),n.outOfStock]}):v(S,{}),configurations:(i==null?void 0:i(M))??M,title:E?v("a",{"data-testid":"product-name",className:I(["cart-summary-item__title",["cart-summary-item__title--strikethrough",q]]),href:E(e),children:($=e==null?void 0:e.product)==null?void 0:$.name}):v("div",{"data-testid":"product-name",className:I(["cart-summary-item__title",["cart-summary-item__title--strikethrough",q]]),children:(B=e==null?void 0:e.product)==null?void 0:B.name}),sku:v("div",{children:(K=e==null?void 0:e.product)==null?void 0:K.sku}),quantity:e!=null&&e.eligibleForReturn&&(e!=null&&e.returnableQuantity)?(e==null?void 0:e.returnableQuantity)??e.totalQuantity:u?void 0:e.totalQuantity,image:E?v("a",{href:E(e),children:v(C,{src:(U=e==null?void 0:e.product)==null?void 0:U.thumbnail.url,alt:(Y=e==null?void 0:e.product)==null?void 0:Y.thumbnail.label,loading:"lazy",width:"90",height:"120"})}):v(C,{src:(G=e==null?void 0:e.product)==null?void 0:G.thumbnail.url,alt:(X=e==null?void 0:e.product)==null?void 0:X.thumbnail.label,loading:"lazy",width:"90",height:"120"}),...L,footer:k&&!a?v(p,{value:1,min:1,max:e==null?void 0:e.returnableQuantity,onValue:b=>k==null?void 0:k(Number(b)),name:"quantity"}):void 0})};export{he as C,se as S,me as a,ie as d};
