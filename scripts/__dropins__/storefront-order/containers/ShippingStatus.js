/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as i,jsxs as S,Fragment as w}from"@dropins/tools/preact-jsx-runtime.js";import{classes as $,VComponent as R,Slot as G}from"@dropins/tools/lib.js";import{Card as A,Header as x,Accordion as V,AccordionSection as B,ContentGrid as M,Image as U}from"@dropins/tools/components.js";import{useState as q,useEffect as tn}from"@dropins/tools/preact-hooks.js";import"../chunks/ShippingStatusCard.js";import"@dropins/tools/preact-compat.js";import{u as sn}from"../chunks/useGetStoreConfig.js";import"@dropins/tools/preact.js";import{events as ln}from"@dropins/tools/event-bus.js";import{C as rn}from"../chunks/OrderLoaders.js";import{u as hn}from"../chunks/useIsMobile.js";import{Text as H,useText as un}from"@dropins/tools/i18n.js";import"../chunks/getStoreConfig.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";var j=(s=>(s.PENDING="pending",s.SHIPPING="shipping",s.COMPLETE="complete",s.PROCESSING="processing",s.HOLD="on hold",s.CANCELED="Canceled",s.SUSPECTED_FRAUD="suspected fraud",s.PAYMENT_REVIEW="payment review",s))(j||{});const dn=({orderData:s})=>{const[r,h]=q(!0),[n,u]=q(s),[l,m]=q(!1);return tn(()=>{const d=ln.on("order/data",g=>{u(g),m(g==null?void 0:g.isVirtual),h(!1)},{eager:!0});return s!=null&&s.id&&h(!1),()=>{d==null||d.off()}},[s]),{loading:r,order:n,isVirtualProduct:l}},en=({value:s,variant:r="primary",size:h="medium",icon:n,className:u,children:l,disabled:m=!1,active:d=!1,activeChildren:g,activeIcon:b,href:e,...C})=>{let c="dropin-button";(n&&!l||n&&d&&!g||!n&&d&&b)&&(c="dropin-iconButton"),d&&g&&(c="dropin-button"),u=$([c,`${c}--${h}`,`${c}--${r}`,[`${c}--${r}--disabled`,m],l&&n&&`${c}--with-icon`,!l&&g&&n&&`${c}--with-icon`,d&&b&&`${c}--with-icon`,u]);const I=$(["dropin-button-icon",`dropin-button-icon--${r}`,[`dropin-button-icon--${r}--disabled`,m],n==null?void 0:n.props.className]),o=e?{node:i("a",{}),role:"link",href:e,...C,disabled:m,active:d,onKeyDown:y=>{m&&y.preventDefault()},tabIndex:m?-1:0}:{node:i("button",{}),role:"button",...C,value:s,disabled:m,active:d};return S(R,{...o,className:u,children:[n&&!d&&i(R,{node:n,className:I}),b&&d&&i(R,{node:b,className:I}),l&&!d&&(typeof l=="string"?i("span",{children:l}):l),d&&g&&(typeof g=="string"?i("span",{children:g}):g)]})},cn=({placeholderImage:s,slots:r,collapseThreshold:h,translations:n,returnData:u,routeTracking:l,routeProductDetails:m})=>{var b;const d=hn(),g=m?"a":"span";return console.log("returnData.items",u),console.log("returnData.items",u.items),S(A,{variant:"secondary",className:$(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[i(x,{title:n.returnOrderCardTitle}),S("div",{children:[(b=u==null?void 0:u.tracking)==null?void 0:b.map((e,C)=>{var y,N;const c={title:"",number:(e==null?void 0:e.trackingNumber)??"",carrier:((y=e==null?void 0:e.carrier)==null?void 0:y.label)??""},I=l==null?void 0:l(c),o=I?()=>{window.open(I,"_blank","noreferrer")}:null;return S("div",{className:"order-shipping-status-card__header",children:[S("div",{children:[`${n.carrier} `,`${(N=c.carrier)==null?void 0:N.toLocaleUpperCase()} | `,c.number]}),o?i(en,{onClick:o,children:n.trackButton}):null]},`${c.number}_${C}`)}),r!=null&&r.ReturnItemsDetails?i(G,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:r==null?void 0:r.ReturnItemsDetails,context:{items:u.items}}):null,i(V,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(B,{defaultOpen:h>=u.items.length,title:i(H,{id:"Order.ShippingStatusCard.itemText",plural:u.items.reduce((e,C)=>e+C.requestQuantity,0),fields:{count:u.items.reduce((e,C)=>e+C.requestQuantity,0)}}),children:i(M,{maxColumns:d?3:9,emptyGridContent:i(w,{}),className:$(["order-shipping-status-card__images",["order-shipping-status-card__images-3",d]]),children:u.items.map((e,C)=>{var o,y,N,T;const c=(o=e.thumbnail)==null?void 0:o.label,I=(N=(y=e.thumbnail)==null?void 0:y.url)!=null&&N.length?(T=e.thumbnail)==null?void 0:T.url:s;return i(g,{href:(m==null?void 0:m(e))??"#","data-testid":`${C}${e.uid}`,children:i(U,{alt:c,src:I,width:85,height:114})},`${C}${e.uid}`)})})})})]})]})},mn=({placeholderImage:s,translations:r,slots:h,orderData:n,collapseThreshold:u=10,routeProductDetails:l,routeTracking:m})=>{var N,T,F,Q,K,W,Y;const d=!!(n!=null&&n.returnNumber),g=n==null?void 0:n.returnNumber,b=l?"a":"span",e=(N=n==null?void 0:n.status)==null?void 0:N.toLocaleLowerCase(),c=((T=n==null?void 0:n.shipments)==null?void 0:T.length)===1&&(e==null?void 0:e.includes(j.COMPLETE)),I=(F=n==null?void 0:n.shipments)==null?void 0:F.every(p=>p.tracking.length===0),o=(Q=n==null?void 0:n.items)==null?void 0:Q.filter(p=>(p==null?void 0:p.quantityShipped)===0||(p==null?void 0:p.quantityShipped)<(p==null?void 0:p.quantityOrdered)),y=(K=n==null?void 0:n.items)==null?void 0:K.reduce((p,f)=>{const a=f.quantityOrdered-f.quantityShipped;return p+(a>0?a:0)},0);if(console.log("0",0),d&&(n!=null&&n.returns.length)){console.log("1",1);const p=n.returns.find(f=>f.returnNumber===g);return!p||p.tracking.length===0?null:(console.log("2",2),i(cn,{placeholderImage:s,slots:h,collapseThreshold:u,translations:r,returnData:p,routeTracking:m,routeProductDetails:l}))}return!n||e!=null&&e.includes(j.CANCELED)?null:(W=n==null?void 0:n.shipments)!=null&&W.length?I&&!(o!=null&&o.length)&&c?null:S(w,{children:[(Y=n==null?void 0:n.shipments)==null?void 0:Y.map(({tracking:p,items:f,id:a},pn)=>{console.log("5",5),console.log("items",f);const E=f.reduce((t,O)=>t+((O==null?void 0:O.quantityShipped)??O.orderItem.quantityShipped??0),0);return console.log("accordionValue",E),S(A,{variant:"secondary",className:"order-shipping-status-card",children:[i(x,{title:r.shippingCardTitle}),p==null?void 0:p.map(t=>{var _;const O=m==null?void 0:m(t),L=O?()=>{window.open(O,"_blank","noreferrer")}:null;return S("div",{className:"order-shipping-status-card__header",role:"status",children:[S("div",{className:"order-shipping-status-card__header--content",children:[S("p",{children:[r.carrier," ",(_=t==null?void 0:t.carrier)==null?void 0:_.toLocaleUpperCase()," | ",t==null?void 0:t.number]}),i("p",{children:t==null?void 0:t.title})]}),h!=null&&h.DeliveryTrackActions?i(G,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:h==null?void 0:h.DeliveryTrackActions,context:{trackInformation:t}}):L?i(en,{onClick:L,children:r.trackButton}):null]},t.number)}),c?null:i(V,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(B,{"data-position":pn+1,defaultOpen:u>=(f==null?void 0:f.length),title:i(H,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:E,fields:{count:E}}),children:i(M,{maxColumns:6,emptyGridContent:i(w,{}),className:"order-shipping-status-card__images",children:f==null?void 0:f.map(t=>{var _,z,J,X,Z,v,P,k,D,nn;const O=(J=(z=(_=t==null?void 0:t.orderItem)==null?void 0:_.product)==null?void 0:z.thumbnail)==null?void 0:J.label,L=(P=(v=(Z=(X=t==null?void 0:t.orderItem)==null?void 0:X.product)==null?void 0:Z.thumbnail)==null?void 0:v.url)!=null&&P.length?(nn=(D=(k=t==null?void 0:t.orderItem)==null?void 0:k.product)==null?void 0:D.thumbnail)==null?void 0:nn.url:s;return i(b,{href:(l==null?void 0:l(t))??"#",children:i(U,{alt:O,src:L,width:85,height:114})},t.id)})})})}),h!=null&&h.DeliveryTimeLine?i(G,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:h==null?void 0:h.DeliveryTimeLine,context:{}}):null]},a)}),o!=null&&o.length?S(A,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[i(x,{title:r.notYetShippedTitle}),i(V,{actionIconPosition:"right",children:i(B,{defaultOpen:u>=(o==null?void 0:o.length),title:i(H,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:y,fields:{count:y}}),children:i(M,{maxColumns:6,emptyGridContent:i(w,{}),className:"order-shipping-status-card__images",children:o==null?void 0:o.map(p=>{var f,a;return i(b,{href:(l==null?void 0:l(p))??"#",children:i(U,{alt:(f=p.thumbnail)==null?void 0:f.label,src:((a=p.thumbnail)==null?void 0:a.url)||"",width:85,height:114})},p.id)})})})})]}):null]}):S(A,{variant:"secondary",className:"order-shipping-status-card",children:[i(x,{title:r.shippingInfoTitle}),i("div",{className:"order-shipping-status-card__header",children:S("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?i("p",{children:n==null?void 0:n.carrier}):null,i("p",{children:r.noInfoTitle})]})})]})},wn=({slots:s,className:r,collapseThreshold:h,orderData:n,routeOrderDetails:u,routeTracking:l,routeProductDetails:m})=>{const{loading:d,order:g,isVirtualProduct:b}=dn({orderData:n}),e=sn(),C=un({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber",trackButton:"Order.ShippingStatusCard.trackButton"});if(!d&&b)return null;const c=(e==null?void 0:e.baseMediaUrl)??"";return i("div",{className:$(["order-shipping-status",r]),children:!d&&g?i(mn,{placeholderImage:c,translations:C,routeOrderDetails:u,routeTracking:l,slots:s,orderData:g,collapseThreshold:h,routeProductDetails:m}):i(rn,{withCard:!1})})};export{wn as ShippingStatus,wn as default};
