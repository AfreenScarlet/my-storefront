import{jsx as n,jsxs as y}from"@dropins/tools/preact-jsx-runtime.js";import{Card as h,Header as T}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{classes as I}from"@dropins/tools/lib.js";import{useState as g,useEffect as P,useMemo as S}from"@dropins/tools/preact-hooks.js";import{events as N}from"@dropins/tools/event-bus.js";import{s as b}from"../chunks/setTaxStatus.js";import{g as k}from"../chunks/getStoreConfig.js";import{Fragment as q}from"@dropins/tools/preact.js";import"@dropins/tools/preact-compat.js";import{e as v}from"../chunks/returnOrdersHelper.js";import{O as G}from"../chunks/OrderLoaders.js";import{C as j}from"../chunks/CartSummaryItem.js";import{useText as w}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/getFormValues.js";const E=({orderData:a})=>{const[u,e]=g(!0),[c,m]=g(a),[f,o]=g({taxIncluded:!1,taxExcluded:!1});return P(()=>{k().then(t=>{if(t){const d=b(t==null?void 0:t.shoppingCartDisplayPrice);o(d)}}).finally(()=>{e(!1)})},[]),P(()=>{const t=N.on("order/data",d=>{m(d)},{eager:!0});return()=>{t==null||t.off()}},[]),{loading:u,taxConfig:f,order:c}},F=({loading:a,taxConfig:u,order:e=null,withHeader:c=!0,showConfigurableOptions:m,routeProductDetails:f})=>{const o=!!(e!=null&&e.returnNumber),t=w({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.returnedTitle",refunded:"Order.OrderProductListContent.refundedTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),d=S(()=>{var p,C;if(!e)return[];if(!o){const{modifyOrder:r,returnedList:l}=v(e),O=r==null?void 0:r.filter(s=>s.quantityCanceled),x=r==null?void 0:r.filter(s=>!s.quantityCanceled);return[{type:"returned",list:l,title:t.returned},{type:"cancelled",list:O,title:t.cancelled},{type:"allItems",list:x,title:t.allOrders}].filter(s=>{var L;return((L=s==null?void 0:s.list)==null?void 0:L.length)>0})}return[{type:"returned",list:((C=(p=e.returns.find(r=>r.returnNumber===(e==null?void 0:e.returnNumber)))==null?void 0:p.items)==null?void 0:C.map(r=>({...r,totalQuantity:r.requestQuantity})))??[],title:t.returned}]},[e,o,t]);return e?d.every(i=>i.list.length===0)?null:n(h,{variant:"secondary",className:"order-order-product-list-content",children:d.map((i,p)=>{var r;const C=i.list.reduce((l,{totalQuantity:O})=>O+l,0);return y(q,{children:[c?n(T,{title:`${i.title} (${C})`}):null,n("ul",{className:"order-order-product-list-content__items",children:(r=i.list)==null?void 0:r.map(l=>n("li",{"data-testid":"order-product-list-content-item",children:n(j,{loading:a,product:l,itemType:i.type,taxConfig:u,translations:t,showConfigurableOptions:m,routeProductDetails:f})},l.id))})]},p)})}):n(G,{})},Z=({className:a,orderData:u,withHeader:e,showConfigurableOptions:c,routeProductDetails:m})=>{const{loading:f,taxConfig:o,order:t}=E({orderData:u});return n("div",{className:I(["order-order-product-list",a]),children:n(F,{loading:f,taxConfig:o,order:t,withHeader:e,showConfigurableOptions:c,routeProductDetails:m})})};export{Z as OrderProductList,Z as default};
