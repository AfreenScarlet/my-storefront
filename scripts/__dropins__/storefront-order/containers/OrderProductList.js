import{jsx as s,jsxs as x}from"@dropins/tools/preact-jsx-runtime.js";import{Card as h,Header as I}from"@dropins/tools/components.js";import{C as S}from"../chunks/OrderCancel.js";import{classes as T}from"@dropins/tools/lib.js";import{useState as O,useEffect as g,useMemo as N}from"@dropins/tools/preact-hooks.js";import{events as b}from"@dropins/tools/event-bus.js";import{s as k}from"../chunks/setTaxStatus.js";import{g as v}from"../chunks/getStoreConfig.js";import{Fragment as G}from"@dropins/tools/preact.js";import"@dropins/tools/preact-compat.js";import{e as j}from"../chunks/deprecatedAdjustments.js";import{O as q}from"../chunks/OrderLoaders.js";import{useText as w}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const E=({orderData:d})=>{const[l,t]=O(!0),[a,u]=O(d),[c,i]=O({taxIncluded:!1,taxExcluded:!1});return g(()=>{v().then(e=>{if(e){const r=k(e==null?void 0:e.shoppingCartDisplayPrice);i(r)}}).finally(()=>{t(!1)})},[]),g(()=>{const e=b.on("order/data",r=>{u(r)},{eager:!0});return()=>{e==null||e.off()}},[]),{loading:l,taxConfig:c,order:a}},F=({loading:d,taxConfig:l,order:t=null,withHeader:a=!0,showConfigurableOptions:u,routeProductDetails:c})=>{const i=!!(t!=null&&t.returnNumber),e=t==null?void 0:t.returnNumber,r=w({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.returnedTitle",refunded:"Order.OrderProductListContent.refundedTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),p=N(()=>{if(!t)return[];if(!i){const{returnedList:o,modifyOrder:m}=j(t),L=o,P=m.filter(f=>f.quantityCanceled),y=m.filter(f=>!f.quantityCanceled);return[{type:"returned",list:L,title:r.returned},{type:"cancelled",list:P,title:r.cancelled},{type:"allItems",list:y,title:r.allOrders}].filter(f=>f.list.length>0)}const n=t.returns.find(o=>o.returnNumber===e);return[{type:"returned",list:(n==null?void 0:n.items)??[],title:r.returned}]},[t,i,r,e]);return t?p.every(n=>n.list.length===0)?null:s(h,{variant:"secondary",className:"order-order-product-list-content",children:p.map((n,C)=>{var o;return x(G,{children:[a?s(I,{title:`${n.title} (${n.list.length})`}):null,s("ul",{className:"order-order-product-list-content__items",children:(o=n.list)==null?void 0:o.map(m=>s("li",{"data-testid":"order-product-list-content-item",children:s(S,{loading:d,product:m,itemType:n.type,taxConfig:l,translations:r,showConfigurableOptions:u,routeProductDetails:c})},m.id))})]},C)})}):s(q,{})},X=({className:d,orderData:l,withHeader:t,showConfigurableOptions:a,routeProductDetails:u})=>{const{loading:c,taxConfig:i,order:e}=E({orderData:l});return s("div",{className:T(["order-order-product-list",d]),children:s(F,{loading:c,taxConfig:i,order:e,withHeader:t,showConfigurableOptions:a,routeProductDetails:u})})};export{X as OrderProductList,X as default};
