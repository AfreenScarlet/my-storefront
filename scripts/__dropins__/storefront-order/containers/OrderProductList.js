import{jsx as s,jsxs as y}from"@dropins/tools/preact-jsx-runtime.js";import{Card as x,Header as h}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{classes as I}from"@dropins/tools/lib.js";import{useState as O,useEffect as g,useMemo as S}from"@dropins/tools/preact-hooks.js";import{events as T}from"@dropins/tools/event-bus.js";import{s as N}from"../chunks/setTaxStatus.js";import{g as b}from"../chunks/getStoreConfig.js";import"@dropins/tools/preact-compat.js";import{Fragment as k}from"@dropins/tools/preact.js";import{O as j}from"../chunks/OrderLoaders.js";import{d as v,C as G}from"../chunks/CartSummaryItem.js";import{useText as q}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const w=({orderData:o})=>{const[l,t]=O(!0),[a,u]=O(o),[c,d]=O({taxIncluded:!1,taxExcluded:!1});return g(()=>{b().then(e=>{e&&d(N(e==null?void 0:e.shoppingCartDisplayPrice))}).finally(()=>{t(!1)})},[]),g(()=>{const e=T.on("order/data",n=>{u(n)},{eager:!0});return()=>{e==null||e.off()}},[]),{loading:l,taxConfig:c,order:a}},E=({loading:o,taxConfig:l,order:t=null,withHeader:a=!0,showConfigurableOptions:u,routeProductDetails:c})=>{const d=!!(t!=null&&t.returnNumber),e=t==null?void 0:t.returnNumber,n=q({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.returnedTitle",refunded:"Order.OrderProductListContent.refundedTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),p=S(()=>{if(!t)return[];if(!d){const i=(t==null?void 0:t.items)??[],f=v(t),L=i.filter(m=>m.quantityCanceled),P=i.filter(m=>!m.quantityCanceled);return[{type:"returned",list:f,title:n.returned},{type:"cancelled",list:L,title:n.cancelled},{type:"allItems",list:P,title:n.allOrders}].filter(m=>m.list.length>0)}const r=t.returns.find(i=>i.returnNumber===e);return[{type:"returned",list:(r==null?void 0:r.items)??[],title:n.returned}]},[t,d,n,e]);return t?p.every(r=>r.list.length===0)?null:s(x,{variant:"secondary",className:"order-order-product-list-content",children:p.map((r,C)=>{var i;return y(k,{children:[a?s(h,{title:`${r.title} (${r.list.length})`}):null,s("ul",{className:"order-order-product-list-content__items",children:(i=r.list)==null?void 0:i.map(f=>s("li",{"data-testid":"order-product-list-content-item",children:s(G,{loading:o,product:f,itemType:r.type,taxConfig:l,translations:n,showConfigurableOptions:u,routeProductDetails:c})},f.id))})]},C)})}):s(j,{})},W=({className:o,orderData:l,withHeader:t,showConfigurableOptions:a,routeProductDetails:u})=>{const{loading:c,taxConfig:d,order:e}=w({orderData:l});return s("div",{className:I(["order-order-product-list",o]),children:s(E,{loading:c,taxConfig:d,order:e,withHeader:t,showConfigurableOptions:a,routeProductDetails:u})})};export{W as OrderProductList,W as default};
