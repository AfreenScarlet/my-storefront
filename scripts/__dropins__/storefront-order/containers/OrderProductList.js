import{jsx as n,jsxs as y}from"@dropins/tools/preact-jsx-runtime.js";import{Card as x,Header as h}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{classes as T}from"@dropins/tools/lib.js";import{useState as g,useEffect as P,useMemo as I}from"@dropins/tools/preact-hooks.js";import{events as S}from"@dropins/tools/event-bus.js";import{s as N}from"../chunks/setTaxStatus.js";import{g as b}from"../chunks/getStoreConfig.js";import{Fragment as k}from"@dropins/tools/preact.js";import"@dropins/tools/preact-compat.js";import{e as v}from"../chunks/returnOrdersHelper.js";import{O as G}from"../chunks/OrderLoaders.js";import{C as j}from"../chunks/CartSummaryItem.js";import{useText as w}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/getFormValues.js";const E=({orderData:l})=>{const[a,r]=g(!0),[u,c]=g(l),[m,o]=g({taxIncluded:!1,taxExcluded:!1});return P(()=>{b().then(t=>{if(t){const s=N(t==null?void 0:t.shoppingCartDisplayPrice);o(s)}}).finally(()=>{r(!1)})},[]),P(()=>{const t=S.on("order/data",s=>{c(s)},{eager:!0});return()=>{t==null||t.off()}},[]),{loading:a,taxConfig:m,order:u}},F=({loading:l,taxConfig:a,order:r=null,withHeader:u=!0,showConfigurableOptions:c,routeProductDetails:m})=>{const o=!!(r!=null&&r.returnNumber),t=w({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.returnedTitle",refunded:"Order.OrderProductListContent.refundedTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),s=I(()=>{var f,p;if(!r)return[];if(!o){const{returnedList:e,canceledItems:d,nonCanceledItems:O}=v(r);return[{type:"returned",list:e,title:t.returned},{type:"cancelled",list:d,title:t.cancelled},{type:"allItems",list:O,title:t.allOrders}].filter(C=>{var L;return((L=C==null?void 0:C.list)==null?void 0:L.length)>0})}return[{type:"returned",list:((p=(f=r.returns.find(e=>e.returnNumber===(r==null?void 0:r.returnNumber)))==null?void 0:f.items)==null?void 0:p.map(e=>({...e,totalQuantity:e.requestQuantity})))??[],title:t.returned}]},[r,o,t]);return r?s.every(i=>i.list.length===0)?null:n(x,{variant:"secondary",className:"order-order-product-list-content",children:s.map((i,f)=>{var e;const p=i.list.reduce((d,{totalQuantity:O})=>O+d,0);return y(k,{children:[u?n(h,{title:`${i.title} (${p})`}):null,n("ul",{className:"order-order-product-list-content__items",children:(e=i.list)==null?void 0:e.map(d=>n("li",{"data-testid":"order-product-list-content-item",children:n(j,{loading:l,product:d,itemType:i.type,taxConfig:a,translations:t,showConfigurableOptions:c,routeProductDetails:m})},d.id))})]},f)})}):n(G,{})},Y=({className:l,orderData:a,withHeader:r,showConfigurableOptions:u,routeProductDetails:c})=>{const{loading:m,taxConfig:o,order:t}=E({orderData:a});return n("div",{className:T(["order-order-product-list",l]),children:n(F,{loading:m,taxConfig:o,order:t,withHeader:r,showConfigurableOptions:u,routeProductDetails:c})})};export{Y as OrderProductList,Y as default};
