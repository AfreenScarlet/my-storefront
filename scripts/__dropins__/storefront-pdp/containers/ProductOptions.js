import{jsx as k}from"@dropins/tools/preact-jsx-runtime.js";import{useState as h,useEffect as L,useCallback as j}from"@dropins/tools/preact-compat.js";import{Slot as R}from"@dropins/tools/lib.js";import{events as w}from"@dropins/tools/event-bus.js";import"@dropins/tools/components.js";/* empty css             */import{S as q}from"../chunks/Swatches.js";import"@dropins/tools/preact.js";import{c as z,j as A,h as G,p as H}from"../chunks/fetchPDPData.js";import{g as C,s as y}from"../chunks/getProductConfigurationValues.js";import{s as g}from"../chunks/isProductConfigurationValid.js";import{g as J}from"../chunks/getFetchedProductData.js";import"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const K=({initialData:f={data:null,optionsUIDs:[]},hideSelectedValue:I=!1,slots:u,onValues:p,onErrors:l,children:N,...v})=>{const[o,O]=h(f.data),[r,b]=h(f.optionsUIDs),[B,M]=h();L(()=>{const i=w.on("pdp/data",O),a=w.on("pdp/values",({optionsUIDs:e})=>{e&&b(e)});return g(()=>{var e;return(r==null?void 0:r.length)===((e=o==null?void 0:o.options)==null?void 0:e.length)}),()=>{i==null||i.off(),a==null||a.off()}},[]);const T=j(async i=>{var d,P,D,S,U;if(!(o!=null&&o.sku))return;const{persistURLParams:a,anchors:e,acdl:F}=z.getConfig();let s=Object.keys(i).map(t=>i[t].value).filter(t=>t!==void 0);if(a&&((d=o==null?void 0:o.options)!=null&&d.some(c=>(c==null?void 0:c.typename)==="ProductViewOptionValueProduct")||A({optionsUIDs:s.join(",")})),((D=(P=C())==null?void 0:P.optionsUIDs)==null?void 0:D.join("|"))!==(s==null?void 0:s.join("|"))){y(n=>({...n,optionsUIDs:s})),p==null||p(s);const t=await G(o.sku);let c=(s==null?void 0:s.length)===((S=t==null?void 0:t.options)==null?void 0:S.length);if(e!=null&&e.length){const n=(t==null?void 0:t.optionUIDs)??[];s.every(m=>n.includes(m))||(M(t==null?void 0:t.options),y(m=>({...m,optionsUIDs:n})),c=(n==null?void 0:n.length)===((U=t==null?void 0:t.options)==null?void 0:U.length))}g(()=>c),F&&t&&(t==null?void 0:t.variantSku)!==o.sku&&H(t)}},[o==null?void 0:o.options,o==null?void 0:o.sku,p]),V=j(i=>{Object.keys(i).length!==0&&(g(()=>!1),l==null||l(i))},[l]);return!o||!o.options?null:k(R,{name:"Swatches",slot:u==null?void 0:u.Swatches,context:{data:o,optionsUIDs:r},children:k(q,{...v,options:o.options,selectedUIDs:r,defaultOptions:r,selectionsToUpdate:B,hideSelectedValue:I,onValues:T,onErrors:V})})};K.getInitialData=async function(){var f;return{data:await J(),optionsUIDs:((f=C())==null?void 0:f.optionsUIDs)??[]}};export{K as ProductOptions,K as default};
